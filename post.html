<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>รายละเอียดกระทู้ - TU-PUP</title>
  <!-- ตั้งค่าการโหลดทรัพยากร -->
  <link rel="preconnect" href="https://cdn.tailwindcss.com">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!-- Custom styles -->
  <link href="css/tu-common.css" rel="stylesheet">
  <link rel="stylesheet" href="css/sidebar.css">
  <!-- Tailwind Config & CDN -->
  <script src="js/tailwind-config.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // ใช้คอนฟิกจากไฟล์ภายนอก
    tailwind.config = window.tailwindConfig;
  </script>
  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- Supabase Config -->
  <script src="js/supabase-config.js"></script>
  <!-- Sidebar JS -->
  <script src="js/sidebar.js"></script>
  <style>
    /* main .container {
      max-width: 900px;
      } */

    main .max-w-4xl {
      max-width: 1500px;
    }

    .comment-item {
      transition: all 0.3s ease;
    }

    .comment-item:hover {
      background-color: rgba(255, 248, 229, 0.5);
    }

    .comment-form textarea:focus {
      box-shadow: 0 0 0 3px rgba(230, 0, 0, 0.2);
      border-color: #E60000;
    }

    /* Animation for new comments */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .new-comment {
      animation: fadeIn 0.5s ease-out forwards;
    }

    /* Badges style */
    .tu-badge {
      background: linear-gradient(135deg, #E60000, #FFCC00);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
      box-shadow: 0 2px 5px rgba(230, 0, 0, 0.2);
    }

    .image-container {
      position: relative;
      overflow: hidden;
      border-radius: 0.5rem;
      transition: all 0.3s ease;
    }

    .image-container:hover {
      transform: scale(1.02);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    .image-container img {
      max-height: 500px;
      object-fit: contain;
      transition: all 0.3s ease;
    }

    .comment-image:hover img {
      transform: scale(1.05);
    }

    .hover-scale {
      transition: transform 0.3s ease;
    }

    .hover-scale:hover {
      transform: scale(1.05);
    }
  </style>
</head>

<body class="bg-gradient-to-br from-white to-gray-100 min-h-screen">
  <!-- Decorative Elements -->
  <div class="fixed top-0 left-0 w-full h-1 tu-gradient opacity-80 z-50"></div>

  <!-- Navbar -->
  <nav class="bg-white shadow-md sticky top-0 z-40">
    <div class="container mx-auto px-4 py-3">
      <div class="flex justify-between items-center">
        <!-- Logo & Hamburger Menu -->
        <div class="flex items-center space-x-4">
          <button id="sidebar-toggle" class="text-gray-500 hover:text-tu-red-500 focus:outline-none">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
          <a href="index.html" class="flex items-center space-x-2">
            <div
              class="h-8 w-8 rounded-full tu-gradient flex items-center justify-center text-white font-bold text-xs shadow-md">
              TU</div>
            <span class="font-bold text-2xl tu-gradient-text">TU-PUP</span>
          </a>
        </div>

        <!-- User Menu -->
        <div class="flex items-center space-x-4">
          <button id="new-post-btn"
            class="hidden bg-gradient-to-r from-tu-red to-tu-yellow hover:from-tu-red-600 hover:to-tu-yellow-600 text-white font-medium px-4 py-2 rounded-full transition duration-300 transform hover:scale-105 shadow-md">
            <span class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
              </svg>
              สร้างกระทู้ใหม่
            </span>
          </button>

          <div id="user-menu" class="hidden relative group">
            <button class="flex items-center space-x-2 focus:outline-none">
              <div class="relative">
                <img id="user-avatar" src="img/default-avatar.png" alt="User"
                  class="w-8 h-8 rounded-full border-2 border-tu-red-200 transition-transform duration-300 group-hover:scale-110">
                <div class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-500 rounded-full border border-white"></div>
              </div>
              <span id="user-name" class="hidden md:inline text-sm font-medium"></span>
              <svg xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 text-gray-400 group-hover:text-tu-red-500 transition-transform duration-300 group-hover:rotate-180"
                fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </button>

            <!-- Dropdown menu -->
            <div
              class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-20 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform group-hover:translate-y-0 translate-y-2">
              <div class="px-4 py-2 border-b border-gray-100">
                <p class="text-sm font-medium text-gray-900" id="dropdown-user-name"></p>
                <p class="text-xs text-gray-500 truncate" id="dropdown-user-email"></p>
              </div>
              <a href="my_posts.html"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-tu-red-50 hover:text-tu-red-500">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-gray-400" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                  </svg>
                  กระทู้ของฉัน
                </div>
              </a>
              <a href="edit-profile.html"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-tu-red-50 hover:text-tu-red-500">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-gray-400" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                  </svg>
                  แก้ไขโปรไฟล์
                </div>
              </a>
              <hr class="my-1 border-gray-100">
              <button id="logout-btn"
                class="w-full text-left block px-4 py-2 text-sm text-tu-red-500 hover:bg-tu-red-50">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                  </svg>
                  ออกจากระบบ
                </div>
              </button>
            </div>
          </div>

          <div id="login-menu" class="flex items-center space-x-3">
            <a href="login.html"
              class="text-tu-red-500 hover:text-tu-red-600 font-medium transition-colors">เข้าสู่ระบบ</a>
            <div class="w-px h-5 bg-gray-300"></div>
            <a href="register.html"
              class="text-tu-red-500 hover:text-tu-red-600 font-medium transition-colors">สมัครสมาชิก</a>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
      <!-- Back Button -->
      <div class="mb-4">
        <a href="index.html" class="flex items-center text-tu-red-500 hover:text-tu-red-600 transition-colors group">
          <svg xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5 mr-1 transform group-hover:-translate-x-1 transition-transform" fill="none"
            viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          <span>กลับไปหน้าหลัก</span>
        </a>
      </div>

      <!-- Post Container -->
      <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        <!-- Post Loading Placeholder -->
        <div id="post-loading" class="animate-pulse">
          <div class="h-8 bg-gray-200 rounded w-3/4 mb-4"></div>
          <div class="flex items-center mb-4">
            <div class="rounded-full bg-gray-200 h-10 w-10 mr-3"></div>
            <div>
              <div class="h-4 bg-gray-200 rounded w-32 mb-1"></div>
              <div class="h-3 bg-gray-200 rounded w-24"></div>
            </div>
          </div>
          <div class="h-4 bg-gray-200 rounded w-full mb-2"></div>
          <div class="h-4 bg-gray-200 rounded w-full mb-2"></div>
          <div class="h-4 bg-gray-200 rounded w-5/6 mb-6"></div>
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div class="h-48 bg-gray-200 rounded"></div>
            <div class="h-48 bg-gray-200 rounded"></div>
          </div>
          <div class="flex justify-between mt-6 pt-4 border-t border-gray-100">
            <div class="h-4 bg-gray-200 rounded w-16"></div>
            <div class="h-4 bg-gray-200 rounded w-16"></div>
          </div>
        </div>

        <!-- Post Content -->
        <div id="post-content" class="hidden">
          <div class="flex justify-between items-start mb-4">
            <h1 id="post-title" class="text-2xl md:text-3xl font-bold text-gray-800 relative inline-block">
              <span class="relative z-10"></span>
              <span
                class="absolute bottom-0 left-0 w-full h-2 bg-gradient-to-r from-tu-red-100 to-tu-yellow-100 rounded-full -z-10"></span>
            </h1>

            <!-- Post Action Buttons (จะแสดงเฉพาะเจ้าของกระทู้) -->
            <div id="post-actions" class="hidden relative">
              <button id="post-menu-btn"
                class="text-gray-500 hover:text-tu-red-500 focus:outline-none p-1 rounded-full hover:bg-tu-red-50 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                </svg>
              </button>
              <div id="post-dropdown"
                class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-1 z-10 hidden transform origin-top-right transition-all duration-200 scale-95 opacity-0">
                <button id="edit-post-btn"
                  class="w-full text-left block px-4 py-2 text-sm text-gray-700 hover:bg-tu-red-50 hover:text-tu-red-500 transition-colors">
                  <div class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-gray-400" fill="none"
                      viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                    แก้ไขกระทู้
                  </div>
                </button>
                <button id="delete-post-btn"
                  class="w-full text-left block px-4 py-2 text-sm text-red-600 hover:bg-red-50 hover:text-red-700 transition-colors">
                  <div class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-red-500" fill="none"
                      viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                    ลบกระทู้
                  </div>
                </button>
              </div>
            </div>
          </div>

          <div class="flex items-start md:items-center mb-6">
            <div class="flex-shrink-0 mr-3 relative">
              <div class="w-12 h-12 rounded-full bg-gradient-to-br from-tu-red-100 to-tu-yellow-100 p-0.5">
                <img id="post-author-avatar" src="img/default-avatar.png" alt="Author"
                  class="w-full h-full rounded-full object-cover">
              </div>
            </div>
            <div>
              <div id="post-author" class="font-semibold text-gray-800"></div>
              <div id="post-date" class="text-gray-500 text-sm flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 mr-1 text-gray-400" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span></span>
              </div>
            </div>
          </div>
          <!-- Post Content -->
          <div id="post-body"
            class="post-body text-gray-700 mb-8 whitespace-pre-line break-words leading-relaxed bg-gradient-to-br from-white to-gray-50 p-6 rounded-lg border border-gray-100 shadow-sm">
            <!-- เนื้อหากระทู้จะถูกเติมที่นี่ด้วย JavaScript -->
          </div>

          <!-- Post Images -->
          <div id="post-images" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8"></div>

          <!-- Post Stats -->
          <div class="flex items-center justify-between border-t border-b border-gray-100 py-4 text-gray-500 text-sm">
            <div class="flex items-center space-x-6">
              <div class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1.5 text-tu-red-400" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                </svg>
                <span id="post-views" class="font-medium">0 ครั้ง</span>
              </div>

              <div class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1.5 text-tu-yellow-400" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
                </svg>
                <span id="post-comments-count" class="font-medium">0 ความคิดเห็น</span>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- Edit Post Form Modal -->
      <div id="edit-modal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto hidden">
        <div
          class="bg-white rounded-xl p-6 max-w-3xl w-full mx-4 max-h-screen overflow-y-auto transform transition-all duration-300 scale-95 opacity-0"
          id="edit-modal-content">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-gray-800 flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-tu-red-500" fill="none"
                viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
              </svg>
              แก้ไขกระทู้
            </h3>
            <button id="close-edit-btn" class="text-gray-400 hover:text-gray-600 transition-colors focus:outline-none">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>

          <form id="edit-post-form" class="space-y-5">
            <div>
              <label for="edit-title" class="block text-gray-700 font-medium mb-2">หัวข้อกระทู้</label>
              <input type="text" id="edit-title"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-tu-red-300 focus:border-tu-red-300 transition-colors"
                placeholder="ใส่หัวข้อกระทู้ของคุณที่นี่" required>
            </div>

            <div>
              <label for="edit-content" class="block text-gray-700 font-medium mb-2">เนื้อหากระทู้</label>
              <textarea id="edit-content"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-tu-red-300 focus:border-tu-red-300 transition-colors"
                rows="10" placeholder="เล่าเรื่องของคุณที่นี่..." required></textarea>
            </div>

            <!-- Image Management -->
            <div>
              <label class="block text-gray-700 font-medium mb-2">รูปภาพประกอบ</label>

              <!-- Current Images (if any) -->
              <div id="current-images" class="mb-4">
                <p class="text-gray-600 mb-2 flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-tu-red-400" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                  </svg>
                  รูปภาพปัจจุบัน:
                </p>
                <div id="edit-post-images" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-2"></div>
              </div>

              <!-- Add New Images -->
              <div>
                <p class="text-gray-600 mb-2 flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-tu-yellow-500" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  เพิ่มรูปภาพใหม่:
                </p>
                <div class="flex flex-wrap items-center mb-3">
                  <label
                    class="cursor-pointer bg-gradient-to-r from-tu-red to-tu-yellow text-white font-medium py-2 px-4 rounded-lg transition duration-300 transform hover:scale-105 shadow-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" fill="none"
                      viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    เลือกรูปภาพ
                    <input type="file" id="edit-image-upload" accept="image/*" class="hidden" multiple>
                  </label>
                  <span class="ml-3 text-sm text-gray-600">สามารถเลือกได้หลายรูป</span>
                </div>
              </div>

              <!-- Image Previews for New Images -->
              <div id="edit-image-previews" class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-3"></div>
            </div>

            <div id="edit-error-message" class="hidden p-4 bg-red-50 border-l-4 border-red-500 rounded-lg text-red-700">
            </div>
            <div id="edit-success-message"
              class="hidden p-4 bg-green-50 border-l-4 border-green-500 rounded-lg text-green-700"></div>

            <div class="flex justify-end space-x-3">
              <button type="button" id="cancel-edit-btn"
                class="bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium py-2 px-6 rounded-lg transition duration-300 transform hover:scale-105 active:scale-95">
                ยกเลิก
              </button>
              <button type="submit" id="save-edit-btn"
                class="bg-gradient-to-r from-tu-red to-tu-yellow hover:from-tu-red-600 hover:to-tu-yellow-600 text-white font-medium py-2 px-6 rounded-lg transition duration-300 transform hover:scale-105 active:scale-95 shadow-md">
                บันทึกการแก้ไข
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Comments Section -->
      <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-tu-yellow-500" fill="none"
            viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
          </svg>
          ความคิดเห็น
          <span id="comments-counter" class="ml-2 text-sm font-normal text-gray-500">(0)</span>
        </h2>

        <!-- Comments List -->
        <div id="comments-container" class="mb-8">
          <!-- Comments Loading Placeholder -->
          <div id="comments-loading" class="animate-pulse space-y-6">
            <div>
              <div class="flex items-center mb-3">
                <div class="rounded-full bg-gray-200 h-10 w-10 mr-3"></div>
                <div>
                  <div class="h-4 bg-gray-200 rounded w-32 mb-1"></div>
                  <div class="h-3 bg-gray-200 rounded w-24"></div>
                </div>
              </div>
              <div class="ml-13">
                <div class="h-4 bg-gray-200 rounded w-full mb-2"></div>
                <div class="h-4 bg-gray-200 rounded w-5/6 mb-2"></div>
                <div class="h-4 bg-gray-200 rounded w-3/4"></div>
              </div>
            </div>

            <div>
              <div class="flex items-center mb-3">
                <div class="rounded-full bg-gray-200 h-10 w-10 mr-3"></div>
                <div>
                  <div class="h-4 bg-gray-200 rounded w-32 mb-1"></div>
                  <div class="h-3 bg-gray-200 rounded w-24"></div>
                </div>
              </div>
              <div class="ml-13">
                <div class="h-4 bg-gray-200 rounded w-full mb-2"></div>
                <div class="h-4 bg-gray-200 rounded w-4/6"></div>
              </div>
            </div>
          </div>

          <!-- No Comments Message -->
          <div id="no-comments" class="hidden py-12 text-center">
            <div class="inline-block p-4 rounded-full bg-gray-100 mb-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
              </svg>
            </div>
            <h3 class="text-lg font-medium text-gray-700 mb-2">ยังไม่มีความคิดเห็น</h3>
            <p class="text-gray-500 mb-6">เป็นคนแรกที่แสดงความคิดเห็นในกระทู้นี้</p>
          </div>

          <!-- Comments Content -->
          <div id="comments-content" class="space-y-6"></div>
        </div>
        <!-- Comment Form -->
        <div id="comment-form-container" class="border-t pt-6">
          <div id="login-to-comment" class="hidden py-6 text-center">
            <p class="mb-4 text-gray-600">โปรดเข้าสู่ระบบเพื่อแสดงความคิดเห็น</p>
            <a href="login.html"
              class="inline-flex items-center bg-gradient-to-r from-tu-red to-tu-yellow text-white font-medium px-6 py-2 rounded-lg transition duration-300 transform hover:scale-105 shadow-md">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
              </svg>
              เข้าสู่ระบบ
            </a>
          </div>

          <div id="comment-form" class="hidden">
            <h3 class="text-lg font-semibold mb-4 flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-tu-red-500" fill="none"
                viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
              </svg>
              แสดงความคิดเห็น
            </h3>

            <div class="mb-4 relative">
              <div class="absolute top-3 left-3 w-10 h-10 rounded-full overflow-hidden bg-gray-100">
                <img id="comment-user-avatar" src="img/default-avatar.png" alt="Your Avatar"
                  class="w-full h-full object-cover">
              </div>
              <textarea id="comment-text"
                class="w-full pl-16 pr-4 py-3 min-h-[120px] border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-tu-red-300 focus:border-tu-red-300 transition-colors"
                placeholder="พิมพ์ความคิดเห็นของคุณที่นี่..."></textarea>
            </div>

            <!-- Image Upload -->
            <div class="mb-5">
              <label class="block text-gray-700 mb-2 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1 text-gray-500" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                แนบรูปภาพ (ไม่บังคับ)
              </label>
              <div class="flex flex-wrap items-center">
                <label
                  class="cursor-pointer bg-gradient-to-r from-tu-red-50 to-tu-yellow-50 hover:from-tu-red-100 hover:to-tu-yellow-100 text-gray-700 font-medium py-2 px-4 rounded-lg transition duration-300 border border-gray-200 flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1 text-tu-red-400" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                  </svg>
                  เลือกรูปภาพ
                  <input type="file" id="comment-image" accept="image/*" class="hidden">
                </label>
                <span id="selected-image-name" class="ml-3 text-gray-600"></span>
              </div>

              <!-- Selected Image Preview -->
              <div id="comment-image-preview-container" class="hidden mt-3 relative">
                <div class="relative inline-block">
                  <img id="comment-image-preview" src="#" alt="Preview"
                    class="max-h-40 rounded-lg border border-gray-200">
                  <button id="remove-image-btn" type="button"
                    class="absolute top-1 right-1 bg-white rounded-full p-1 shadow-md hover:bg-red-50 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-red-500" fill="none" viewBox="0 0 24 24"
                      stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <!-- Comment Error/Success Message -->
            <div id="comment-error-message" class="hidden p-3 bg-red-50 text-red-700 rounded-lg mb-4"></div>
            <div id="comment-success-message" class="hidden p-3 bg-green-50 text-green-700 rounded-lg mb-4"></div>

            <div class="flex items-center justify-between">
              <p class="text-sm text-gray-500">กรุณาใช้ภาษาที่สุภาพในการแสดงความคิดเห็น</p>
              <button id="submit-comment-btn"
                class="bg-gradient-to-r from-tu-red to-tu-yellow hover:from-tu-red-600 hover:to-tu-yellow-600 text-white font-medium px-6 py-2 rounded-lg transition duration-300 transform hover:scale-105 active:scale-95 shadow-md flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                </svg>
                ส่งความคิดเห็น
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Edit Comment Modal -->
      <div id="edit-comment-modal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto hidden">
        <div
          class="bg-white rounded-xl p-6 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto transform transition-all duration-300 scale-95 opacity-0"
          id="edit-comment-modal-content">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-gray-800 flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-tu-red-500" fill="none"
                viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
              </svg>
              แก้ไขความคิดเห็น
            </h3>
            <button id="close-edit-comment-btn" class="text-gray-400 hover:text-gray-600 transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>

          <form id="edit-comment-form" class="space-y-4">
            <input type="hidden" id="edit-comment-id">

            <div>
              <label for="edit-comment-content" class="block text-gray-700 font-medium mb-2">เนื้อหาความคิดเห็น</label>
              <textarea id="edit-comment-content"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-tu-red-300 focus:border-tu-red-300 transition-colors"
                rows="6" placeholder="พิมพ์ความคิดเห็นของคุณที่นี่..." required></textarea>
            </div>

            <!-- Image Management -->
            <div>
              <!-- Current Image (if any) -->
              <div id="current-comment-image" class="hidden mb-4">
                <p class="text-gray-600 mb-2 flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-tu-red-400" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                  </svg>
                  รูปภาพปัจจุบัน:
                </p>
                <div class="relative inline-block">
                  <img id="edit-comment-current-image" src="#" alt="Current comment image"
                    class="max-h-48 rounded-lg border border-gray-200">
                  <button id="remove-comment-image-btn" type="button"
                    class="absolute top-1 right-1 bg-white rounded-full p-1 shadow-md hover:bg-red-50 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-red-500" fill="none" viewBox="0 0 24 24"
                      stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>
              </div>

              <!-- Add New Image -->
              <div id="add-comment-image-section">
                <p class="text-gray-600 mb-2 flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-tu-yellow-500" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  เพิ่มรูปภาพใหม่:
                </p>
                <div class="flex flex-wrap items-center mb-3">
                  <label
                    class="cursor-pointer bg-gradient-to-r from-tu-red-50 to-tu-yellow-50 hover:from-tu-red-100 hover:to-tu-yellow-100 text-gray-700 font-medium py-2 px-4 rounded-lg transition duration-300 border border-gray-200 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1 text-tu-red-400" fill="none"
                      viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    เลือกรูปภาพ
                    <input type="file" id="edit-comment-image-upload" accept="image/*" class="hidden">
                  </label>
                  <span id="selected-comment-image-name" class="ml-3 text-gray-600"></span>
                </div>
              </div>

              <!-- Image Preview for New Image -->
              <div id="edit-comment-image-preview-container" class="hidden mt-3">
                <div class="relative inline-block">
                  <img id="edit-comment-image-preview" src="#" alt="Preview"
                    class="max-h-40 rounded-lg border border-gray-200">
                  <button id="remove-edit-comment-image-btn" type="button"
                    class="absolute top-1 right-1 bg-white rounded-full p-1 shadow-md hover:bg-red-50 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-red-500" fill="none" viewBox="0 0 24 24"
                      stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <div id="edit-comment-error-message" class="hidden p-3 bg-red-50 text-red-700 rounded-lg"></div>
            <div id="edit-comment-success-message" class="hidden p-3 bg-green-50 text-green-700 rounded-lg"></div>

            <div class="flex justify-end space-x-3">
              <button type="button" id="cancel-edit-comment-btn"
                class="bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium py-2 px-6 rounded-lg transition duration-300 transform hover:scale-105 active:scale-95">
                ยกเลิก
              </button>
              <button type="submit" id="save-edit-comment-btn"
                class="bg-gradient-to-r from-tu-red to-tu-yellow hover:from-tu-red-600 hover:to-tu-yellow-600 text-white font-medium py-2 px-6 rounded-lg transition duration-300 transform hover:scale-105 active:scale-95 shadow-md">
                บันทึกการแก้ไข
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Delete Comment Confirmation Modal -->
      <div id="delete-comment-modal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div
          class="bg-white rounded-xl p-6 max-w-md w-full mx-4 transform transition-all duration-300 scale-95 opacity-0"
          id="delete-comment-modal-content">
          <div class="text-center mb-5">
            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-50 mb-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
            </div>
            <h3 class="text-xl font-bold text-gray-800 mb-2">ยืนยันการลบความคิดเห็น</h3>
            <p class="text-gray-600 mb-6">
              คุณแน่ใจหรือไม่ว่าต้องการลบความคิดเห็นนี้?
              <br>การกระทำนี้ไม่สามารถย้อนกลับได้
            </p>
          </div>
          <input type="hidden" id="delete-comment-id">
          <div class="flex justify-center space-x-3">
            <button id="cancel-delete-comment-btn"
              class="bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium py-2 px-6 rounded-lg transition duration-300 transform hover:scale-105 active:scale-95">
              ยกเลิก
            </button>
            <button id="confirm-delete-comment-btn"
              class="bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-6 rounded-lg transition duration-300 transform hover:scale-105 active:scale-95 shadow-md">
              ลบความคิดเห็น
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Delete Post Confirmation Modal -->
  <div id="delete-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4 transform transition-all duration-300 scale-95 opacity-0"
      id="delete-modal-content">
      <div class="text-center mb-5">
        <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-50 mb-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
          </svg>
        </div>
        <h3 class="text-xl font-bold text-gray-800 mb-2">ยืนยันการลบกระทู้</h3>
        <p class="text-gray-600 mb-6">
          คุณแน่ใจหรือไม่ว่าต้องการลบกระทู้นี้?
          <br>การกระทำนี้ไม่สามารถย้อนกลับได้
        </p>
      </div>
      <div class="flex justify-center space-x-3">
        <button id="cancel-delete-btn"
          class="bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium py-2 px-6 rounded-lg transition duration-300 transform hover:scale-105 active:scale-95">
          ยกเลิก
        </button>
        <button id="confirm-delete-btn"
          class="bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-6 rounded-lg transition duration-300 transform hover:scale-105 active:scale-95 shadow-md">
          ลบกระทู้
        </button>
      </div>
    </div>
  </div>

  <!-- Back to Top Button -->
  <button id="back-to-top"
    class="fixed bottom-6 right-6 bg-gradient-to-r from-tu-red to-tu-yellow text-white rounded-full p-3 shadow-lg hover:shadow-xl transform transition-transform hover:scale-110 opacity-0 invisible">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 11l7-7 7 7M5 19l7-7 7 7" />
    </svg>
  </button>
  <!-- Footer -->
  <footer class="bg-white border-t mt-8 py-8">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-6 md:mb-0">
          <div class="flex items-center space-x-2 mb-3">
            <div class="h-8 w-8 rounded-full tu-gradient flex items-center justify-center text-white font-bold text-xs">
              TU</div>
            <span class="font-bold text-2xl tu-gradient-text">TU-PUP</span>
          </div>
          <p class="text-gray-600 max-w-md">ระบบกระดานสนทนาเกี่ยวกับสัตว์เลี้ยงสำหรับประชาคมธรรมศาสตร์
            แลกเปลี่ยนความคิดเห็น ถาม-ตอบปัญหา แชร์ประสบการณ์</p>
        </div>
        <p class="text-gray-600 text-sm">&copy; 2025 TU-PUP. สงวนลิขสิทธิ์.</p>
      </div>
    </div>
  </footer>

  <script>
    // ประกาศตัวแปรสำหรับการแก้ไขกระทู้
    let currentPost = null; // เก็บข้อมูลกระทู้ปัจจุบัน
    let imagesToRemove = []; // รายการ URL ของรูปภาพที่จะลบ
    let newImagesToUpload = []; // รายการไฟล์รูปภาพใหม่ที่จะอัปโหลด

    // ประกาศตัวแปรสำหรับการแก้ไขความคิดเห็น
    let currentComment = null; // เก็บข้อมูลความคิดเห็นที่กำลังแก้ไข
    let removeCommentImage = false; // ใช้ตรวจสอบว่าต้องการลบรูปภาพความคิดเห็นหรือไม่
    let newCommentImage = null; // ไฟล์รูปภาพใหม่ที่จะอัปโหลดสำหรับความคิดเห็น

    document.addEventListener("DOMContentLoaded", async function () {
      // ดึง Post ID จาก URL
      const urlParams = new URLSearchParams(window.location.search);
      const postId = urlParams.get("id");

      if (!postId) {
        window.location.href = "index.html";
        return;
      }

      // ตรวจสอบสถานะการล็อกอิน
      const {
        data: { user },
      } = await supabase.auth.getUser();

      // แสดงหรือซ่อนเมนูตามสถานะล็อกอิน
      if (user) {
        document.getElementById("login-menu").classList.add("hidden");
        document.getElementById("user-menu").classList.remove("hidden");
        document.getElementById("new-post-btn").classList.remove("hidden");
        document.getElementById("login-to-comment").classList.add("hidden");
        document.getElementById("comment-form").classList.remove("hidden");

        // แสดงรูปโปรไฟล์ของผู้ใช้ในฟอร์มแสดงความคิดเห็น
        if (user.user_metadata?.avatar_url) {
          document.getElementById("comment-user-avatar").src = user.user_metadata.avatar_url;
        }

        const displayName = user.user_metadata?.display_name || user.email;
        document.getElementById("user-name").textContent = displayName;
        document.getElementById("dropdown-user-name").textContent = displayName;
        document.getElementById("dropdown-user-email").textContent = user.email;

        // ตรวจสอบรูปโปรไฟล์
        if (user.user_metadata?.avatar_url) {
          document.getElementById("user-avatar").src = user.user_metadata.avatar_url;
        }

        // Event listener สำหรับปุ่มล็อกเอาต์
        document.getElementById("logout-btn").addEventListener("click", async () => {
          const { error } = await supabase.auth.signOut();
          if (!error) {
            window.location.reload();
          }
        });
      } else {
        document.getElementById("login-to-comment").classList.remove("hidden");
      }

      // ตั้งค่าปุ่ม Back to Top
      const backToTopButton = document.getElementById('back-to-top');

      window.addEventListener('scroll', function () {
        if (window.scrollY > 500) {
          backToTopButton.classList.remove('opacity-0', 'invisible');
          backToTopButton.classList.add('opacity-100', 'visible');
        } else {
          backToTopButton.classList.remove('opacity-100', 'visible');
          backToTopButton.classList.add('opacity-0', 'invisible');
        }
      });

      backToTopButton.addEventListener('click', function () {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });

      // Event listeners สำหรับปุ่มสร้างกระทู้ใหม่
      document.getElementById("new-post-btn").addEventListener("click", () => {
        window.location.href = "new-post.html";
      });

      // โหลดข้อมูลกระทู้
      await loadPost(postId, user);

      // โหลดความคิดเห็น
      await loadComments(postId, user);

      // จัดการรูปภาพที่แนบกับความคิดเห็น
      document.getElementById("comment-image").addEventListener("change", function (e) {
        const file = e.target.files[0];
        if (file) {
          document.getElementById("selected-image-name").textContent = file.name;
          document.getElementById("comment-image-preview-container").classList.remove("hidden");

          // แสดงตัวอย่างรูปภาพ
          const reader = new FileReader();
          reader.onload = function (e) {
            document.getElementById("comment-image-preview").src = e.target.result;
          };
          reader.readAsDataURL(file);
        }
      });

      // ลบรูปภาพที่เลือก
      document.getElementById("remove-image-btn").addEventListener("click", function () {
        document.getElementById("comment-image").value = "";
        document.getElementById("selected-image-name").textContent = "";
        document.getElementById("comment-image-preview-container").classList.add("hidden");
      });

      // ส่งความคิดเห็น
      document.getElementById("submit-comment-btn").addEventListener("click", async function () {
        if (!user) {
          window.location.href = "login.html";
          return;
        }

        const commentText = document.getElementById("comment-text").value.trim();
        const commentImageInput = document.getElementById("comment-image");
        const commentErrorMsg = document.getElementById("comment-error-message");
        const commentSuccessMsg = document.getElementById("comment-success-message");

        // ซ่อนข้อความแจ้งเตือนเก่าก่อน
        commentErrorMsg.classList.add("hidden");
        commentSuccessMsg.classList.add("hidden");

        if (!commentText && !commentImageInput.files[0]) {
          commentErrorMsg.textContent = "โปรดใส่ข้อความหรือรูปภาพ";
          commentErrorMsg.classList.remove("hidden");
          return;
        }

        // ปิดปุ่มส่งความคิดเห็นระหว่างที่กำลังส่ง
        const submitBtn = this;
        const originalBtnText = submitBtn.innerHTML;
        submitBtn.disabled = true;
        submitBtn.innerHTML = `
          <svg class="animate-spin h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          กำลังส่ง...
        `;

        try {
          let imageUrl = null;

          // อัปโหลดรูปภาพ (ถ้ามี)
          if (commentImageInput.files[0]) {
            try {
              const file = commentImageInput.files[0];
              imageUrl = await uploadImage(file, "comments");
            } catch (uploadError) {
              commentErrorMsg.textContent = "เกิดข้อผิดพลาดในการอัปโหลดรูปภาพ: " + uploadError.message;
              commentErrorMsg.classList.remove("hidden");
              throw uploadError;
            }
          }

          // สร้างความคิดเห็นใหม่
          await createComment(postId, commentText, imageUrl);

          // แสดงข้อความสำเร็จ
          commentSuccessMsg.textContent = "เพิ่มความคิดเห็นเรียบร้อยแล้ว";
          commentSuccessMsg.classList.remove("hidden");

          // รีเซ็ตฟอร์ม
          document.getElementById("comment-text").value = "";
          document.getElementById("comment-image").value = "";
          document.getElementById("selected-image-name").textContent = "";
          document.getElementById("comment-image-preview-container").classList.add("hidden");

          // โหลดความคิดเห็นใหม่
          await loadComments(postId, user);

          // ดึงข้อมูลกระทู้ใหม่เพื่ออัปเดตจำนวนความคิดเห็นที่แสดงในหน้าเว็บ
          const { data: post } = await supabase
            .from("posts")
            .select("comment_count")
            .eq("id", postId)
            .single();

          if (post) {
            document.getElementById("post-comments-count").textContent = `${post.comment_count || 0} ความคิดเห็น`;
            document.getElementById("comments-counter").textContent = `(${post.comment_count || 0})`;
          }

          // ซ่อนข้อความสำเร็จหลังจาก 3 วินาที
          setTimeout(() => {
            commentSuccessMsg.classList.add("hidden");
          }, 3000);
        } catch (error) {
          console.error("Error submitting comment:", error);
          if (!commentErrorMsg.classList.contains("hidden")) {
            // ถ้ามีข้อความผิดพลาดอยู่แล้ว ไม่ต้องแสดงซ้ำ
          } else {
            commentErrorMsg.textContent = "เกิดข้อผิดพลาดในการส่งความคิดเห็น โปรดลองอีกครั้ง";
            commentErrorMsg.classList.remove("hidden");
          }
        } finally {
          // เปิดปุ่มส่งความคิดเห็นอีกครั้ง
          submitBtn.disabled = false;
          submitBtn.innerHTML = originalBtnText;
        }
      });

      // ตั้งค่า modals
      setupModals();
    });

    // ตั้งค่า modals และ event handlers
    function setupModals() {
      // Modal ลบกระทู้
      const deleteModal = document.getElementById("delete-modal");
      const deleteModalContent = document.getElementById("delete-modal-content");
      const deletePostBtn = document.getElementById("delete-post-btn");
      const cancelDeleteBtn = document.getElementById("cancel-delete-btn");
      const confirmDeleteBtn = document.getElementById("confirm-delete-btn");

      // Modal แก้ไขกระทู้
      const editModal = document.getElementById("edit-modal");
      const editModalContent = document.getElementById("edit-modal-content");
      const editPostBtn = document.getElementById("edit-post-btn");
      const closeEditBtn = document.getElementById("close-edit-btn");
      const cancelEditBtn = document.getElementById("cancel-edit-btn");

      // Modal แก้ไขความคิดเห็น
      const editCommentModal = document.getElementById("edit-comment-modal");
      const editCommentModalContent = document.getElementById("edit-comment-modal-content");
      if (!editCommentModal || !editCommentModalContent) {
        console.error("Modal elements for editing comments not found!");
      }
      const closeEditCommentBtn = document.getElementById("close-edit-comment-btn");
      const cancelEditCommentBtn = document.getElementById("cancel-edit-comment-btn");

      // Modal ลบความคิดเห็น
      const deleteCommentModal = document.getElementById("delete-comment-modal");
      const deleteCommentModalContent = document.getElementById("delete-comment-modal-content");
      // ตรวจสอบว่า elements เหล่านี้มีอยู่จริง
      if (!deleteCommentModal || !deleteCommentModalContent) {
        console.error("Modal elements for deleting comments not found!");
      }
      const cancelDeleteCommentBtn = document.getElementById("cancel-delete-comment-btn");
      const confirmDeleteCommentBtn = document.getElementById("confirm-delete-comment-btn");

      // Menu dropdown สำหรับกระทู้
      const postMenuBtn = document.getElementById("post-menu-btn");
      const postDropdown = document.getElementById("post-dropdown");

      if (postMenuBtn) {
        postMenuBtn.addEventListener("click", function (e) {
          e.stopPropagation();

          // Toggle dropdown and animate
          if (postDropdown.classList.contains("hidden")) {
            postDropdown.classList.remove("hidden");
            setTimeout(() => {
              postDropdown.classList.remove("scale-95", "opacity-0");
              postDropdown.classList.add("scale-100", "opacity-100");
            }, 10);
          } else {
            postDropdown.classList.add("scale-95", "opacity-0");
            setTimeout(() => {
              postDropdown.classList.add("hidden");
            }, 200);
          }
        });
      }

      // เปิดปิด Modal ลบกระทู้
      if (deletePostBtn) {
        deletePostBtn.addEventListener("click", () => {
          deleteModal.classList.remove("hidden");
          setTimeout(() => {
            deleteModalContent.classList.remove("scale-95", "opacity-0");
            deleteModalContent.classList.add("scale-100", "opacity-100");
          }, 10);
        });
      }

      cancelDeleteBtn.addEventListener("click", () => {
        deleteModalContent.classList.remove("scale-100", "opacity-100");
        deleteModalContent.classList.add("scale-95", "opacity-0");
        setTimeout(() => {
          deleteModal.classList.add("hidden");
        }, 200);
      });

      // เปิดปิด Modal แก้ไขกระทู้
      if (editPostBtn) {
        editPostBtn.addEventListener("click", () => {
          initEditForm();
          editModal.classList.remove("hidden");
          setTimeout(() => {
            editModalContent.classList.remove("scale-95", "opacity-0");
            editModalContent.classList.add("scale-100", "opacity-100");
          }, 10);
        });
      }

      closeEditBtn.addEventListener("click", closeEditModal);
      cancelEditBtn.addEventListener("click", closeEditModal);

      // เปิดปิด Modal แก้ไขความคิดเห็น
      closeEditCommentBtn.addEventListener("click", closeEditCommentModal);
      cancelEditCommentBtn.addEventListener("click", closeEditCommentModal);

      // เปิดปิด Modal ลบความคิดเห็น
      cancelDeleteCommentBtn.addEventListener("click", () => {
        deleteCommentModalContent.classList.remove("scale-100", "opacity-100");
        deleteCommentModalContent.classList.add("scale-95", "opacity-0");
        setTimeout(() => {
          deleteCommentModal.classList.add("hidden");
        }, 200);
      });

      // ปิดเมนูเมื่อคลิกที่อื่น
      document.addEventListener("click", function (e) {
        if (postDropdown && !postDropdown.contains(e.target) && !postMenuBtn.contains(e.target)) {
          postDropdown.classList.add("scale-95", "opacity-0");
          setTimeout(() => {
            postDropdown.classList.add("hidden");
          }, 200);
        }

        // ปิดเมนูความคิดเห็นทั้งหมด
        document.querySelectorAll(".comment-dropdown").forEach((dropdown) => {
          // ตรวจสอบว่า e.target ไม่ได้อยู่ใน dropdown หรือปุ่มที่เปิด dropdown
          const menuBtn = dropdown.previousElementSibling;
          if (!dropdown.contains(e.target) && (!menuBtn || !menuBtn.contains(e.target))) {
            dropdown.classList.add("scale-95", "opacity-0");
            setTimeout(() => {
              dropdown.classList.add("hidden");
            }, 200);
          }
        });
      });

      // ส่งฟอร์มแก้ไขกระทู้
      document.getElementById("edit-post-form").addEventListener("submit", handleEditFormSubmit);

      // ส่งฟอร์มแก้ไขความคิดเห็น
      document.getElementById("edit-comment-form").addEventListener("submit", handleEditCommentFormSubmit);

      // จัดการอัปโหลดรูปภาพใหม่
      document.getElementById("edit-image-upload").addEventListener("change", handleEditImageUpload);

      // จัดการการแสดงตัวอย่างรูปภาพใหม่สำหรับความคิดเห็น
      document.getElementById("edit-comment-image-upload").addEventListener("change", handleEditCommentImageUpload);

      // ลบรูปภาพความคิดเห็นปัจจุบัน
      document.getElementById("remove-comment-image-btn").addEventListener("click", function () {
        removeCommentImage = true;
        document.getElementById("current-comment-image").classList.add("hidden");
        document.getElementById("add-comment-image-section").classList.remove("hidden");
      });

      // ลบรูปภาพความคิดเห็นใหม่ที่เลือก
      document.getElementById("remove-edit-comment-image-btn").addEventListener("click", function () {
        newCommentImage = null;
        document.getElementById("edit-comment-image-upload").value = "";
        document.getElementById("selected-comment-image-name").textContent = "";
        document.getElementById("edit-comment-image-preview-container").classList.add("hidden");
      });

      // ยืนยันการลบกระทู้
      confirmDeleteBtn.addEventListener("click", async () => {
        const urlParams = new URLSearchParams(window.location.search);
        const postId = urlParams.get("id");

        if (!postId) return;

        // แสดงสถานะกำลังลบ
        confirmDeleteBtn.disabled = true;
        confirmDeleteBtn.innerHTML = `
          <svg class="animate-spin h-5 w-5 mr-2 inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          กำลังลบ...
        `;

        try {
          // ลบกระทู้
          const { error } = await supabase
            .from("posts")
            .delete()
            .eq("id", postId);

          if (error) throw error;

          // แสดง Toast หรือ Alert ว่าลบสำเร็จ
          alert("ลบกระทู้เรียบร้อยแล้ว");
          window.location.href = "index.html";
        } catch (error) {
          console.error("Error deleting post:", error);
          alert("เกิดข้อผิดพลาดในการลบกระทู้ โปรดลองอีกครั้ง");

          // คืนสถานะปุ่ม
          confirmDeleteBtn.disabled = false;
          confirmDeleteBtn.textContent = "ลบกระทู้";

          // ปิด modal
          deleteModalContent.classList.remove("scale-100", "opacity-100");
          deleteModalContent.classList.add("scale-95", "opacity-0");
          setTimeout(() => {
            deleteModal.classList.add("hidden");
          }, 200);
        }
      });

      // ยืนยันการลบความคิดเห็น
      confirmDeleteCommentBtn.addEventListener("click", async () => {
        const commentId = document.getElementById("delete-comment-id").value;
        const urlParams = new URLSearchParams(window.location.search);
        const postId = urlParams.get("id");

        if (!commentId || !postId) {
          deleteCommentModal.classList.add("hidden");
          return;
        }

        // แสดงสถานะกำลังลบ
        confirmDeleteCommentBtn.disabled = true;
        confirmDeleteCommentBtn.innerHTML = `
          <svg class="animate-spin h-5 w-5 mr-2 inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          กำลังลบ...
        `;

        try {
          // ลบความคิดเห็น
          const { error } = await supabase
            .from("comments")
            .delete()
            .eq("id", commentId);

          if (error) throw error;

          // ลดจำนวนความคิดเห็นของกระทู้
          await decrementCommentCount(postId);

          // ปิด modal
          deleteCommentModalContent.classList.remove("scale-100", "opacity-100");
          deleteCommentModalContent.classList.add("scale-95", "opacity-0");
          setTimeout(() => {
            deleteCommentModal.classList.add("hidden");
          }, 200);

          // โหลดความคิดเห็นใหม่
          const { data: { user } } = await supabase.auth.getUser();
          await loadComments(postId, user);

          // ดึงข้อมูลกระทู้ใหม่เพื่ออัปเดตจำนวนความคิดเห็นที่แสดงในหน้าเว็บ
          const { data: post } = await supabase
            .from("posts")
            .select("comment_count")
            .eq("id", postId)
            .single();

          if (post) {
            document.getElementById("post-comments-count").textContent = `${post.comment_count || 0} ความคิดเห็น`;
            document.getElementById("comments-counter").textContent = `(${post.comment_count || 0})`;
          }
        } catch (error) {
          console.error("Error deleting comment:", error);
          alert("เกิดข้อผิดพลาดในการลบความคิดเห็น โปรดลองอีกครั้ง");
          confirmDeleteCommentBtn.disabled = false;
          confirmDeleteCommentBtn.textContent = "ลบความคิดเห็น";
        }
      });
    }

    // โหลดข้อมูลกระทู้
    async function loadPost(postId, currentUser) {
      try {
        // แสดง loading indicator
        document.getElementById("post-loading").classList.remove("hidden");
        document.getElementById("post-content").classList.add("hidden");

        // ดึงข้อมูลกระทู้
        const { data: post, error } = await supabase
          .from("posts")
          .select("*")
          .eq("id", postId)
          .single();

        if (error) throw error;

        if (!post) {
          window.location.href = "index.html";
          return;
        }

        // อัปเดตตัวแปร currentPost เพื่อใช้ในการแก้ไขกระทู้
        currentPost = post;

        // บันทึกการเข้าชมกระทู้ในตาราง posts_view
        await recordPostView(postId, currentUser);

        // ดึงจำนวนการเข้าชมทั้งหมดจากตาราง posts_view
        const viewCount = await getPostViewCount(postId);

        // ซ่อน loading
        document.getElementById("post-loading").classList.add("hidden");
        document.getElementById("post-content").classList.remove("hidden");

        // กำหนดเนื้อหากระทู้
        document.title = `${post.title} - TU-PUP`;
        document.getElementById("post-title").querySelector("span").textContent = post.title;
        document.getElementById("post-author").textContent = post.author_name;
        document.getElementById("post-date").querySelector("span").textContent = formatTimestamp(post.created_at);
        document.getElementById("post-body").textContent = post.content;
        document.getElementById("post-views").textContent = `${viewCount} ครั้ง`;
        document.getElementById("post-comments-count").textContent = `${post.comment_count || 0} ความคิดเห็น`;
        document.getElementById("comments-counter").textContent = `(${post.comment_count || 0})`;

        // แสดงรูปภาพ (ถ้ามี)
        const postImages = document.getElementById("post-images");
        postImages.innerHTML = "";

        if (post.image_urls && post.image_urls.length > 0) {
          post.image_urls.forEach((imageUrl) => {
            const imageContainer = document.createElement("div");
            imageContainer.className = "image-container hover-scale bg-gradient-to-br from-white to-gray-50 p-1 shadow-sm";

            const image = document.createElement("img");
            image.src = imageUrl;
            image.alt = "Post image";
            image.className = "rounded-lg w-full";

            imageContainer.appendChild(image);
            postImages.appendChild(imageContainer);
          });
          postImages.classList.remove("hidden");
        } else {
          postImages.classList.add("hidden");
        }

        // ตรวจสอบสิทธิ์การจัดการกระทู้ (ต้องเป็นเจ้าของกระทู้)
        if (currentUser && post.author_id === currentUser.id) {
          // แสดงกลุ่มปุ่มจัดการกระทู้
          document.getElementById("post-actions").classList.remove("hidden");
        } else {
          // ซ่อนกลุ่มปุ่มจัดการกระทู้
          document.getElementById("post-actions").classList.add("hidden");
        }
      } catch (error) {
        console.error("Error loading post:", error);
        alert("เกิดข้อผิดพลาดในการโหลดกระทู้ โปรดลองอีกครั้ง");
      }
    }

    // โหลดความคิดเห็น
    async function loadComments(postId, currentUser) {
      try {
        // แสดง loading indicator
        document.getElementById("comments-loading").classList.remove("hidden");
        document.getElementById("comments-content").classList.add("hidden");
        document.getElementById("no-comments").classList.add("hidden");

        // ดึงความคิดเห็นของกระทู้
        const { data: comments, error } = await supabase
          .from("comments")
          .select("*")
          .eq("post_id", postId)
          .order("created_at", { ascending: true });

        if (error) throw error;

        // ซ่อน loading
        document.getElementById("comments-loading").classList.add("hidden");

        const commentsContent = document.getElementById("comments-content");
        commentsContent.innerHTML = "";

        if (!comments || comments.length === 0) {
          document.getElementById("no-comments").classList.remove("hidden");
          document.getElementById("comments-content").classList.add("hidden");
          return;
        }

        document.getElementById("no-comments").classList.add("hidden");
        document.getElementById("comments-content").classList.remove("hidden");

        // แสดงความคิดเห็น
        comments.forEach((comment, index) => {
          const commentEl = document.createElement("div");
          commentEl.className = "comment-item bg-white border border-gray-100 rounded-xl p-5 shadow-sm transition-all duration-300";
          commentEl.id = `comment-${comment.id}`;

          let commentHtml = `
        <div class="flex justify-between items-start">
          <div class="flex items-start mb-3">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-tu-red-100 to-tu-yellow-100 p-0.5 flex-shrink-0 mr-3">
              <img src="img/default-avatar.png" alt="User" class="w-full h-full rounded-full object-cover">
            </div>
            <div>
              <div class="font-medium text-gray-800">${comment.author_name}</div>
              <div class="text-gray-500 text-xs flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                ${formatTimestamp(comment.created_at)}
              </div>
            </div>
          </div>
        `;

          // แสดงปุ่มแก้ไข/ลบสำหรับเจ้าของความคิดเห็น
          if (currentUser && comment.author_id === currentUser.id) {
            commentHtml += `
          <div class="comment-actions relative">
            <button
              class="comment-menu-btn text-gray-400 hover:text-tu-red-500 focus:outline-none p-1 rounded-full hover:bg-tu-red-50 transition-colors"
              data-id="${comment.id}"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
              </svg>
            </button>
            <div class="comment-dropdown absolute right-0 mt-2 w-40 bg-white rounded-lg shadow-lg py-1 z-10 hidden transform origin-top-right transition-all duration-200 scale-95 opacity-0">
              <button class="edit-comment-btn w-full text-left block px-4 py-2 text-sm text-gray-700 hover:bg-tu-red-50 hover:text-tu-red-500 transition-colors" data-id="${comment.id}">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                  </svg>
                  แก้ไข
                </div>
              </button>
              <button class="delete-comment-btn w-full text-left block px-4 py-2 text-sm text-red-600 hover:bg-red-50 hover:text-red-700 transition-colors" data-id="${comment.id}">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                  </svg>
                  ลบ
                </div>
              </button>
            </div>
          </div>
        `;
          }

          commentHtml += `
        </div>
        <div class="ml-13 pl-0 md:pl-13">
          <div class="comment-content text-gray-700 mb-3 whitespace-pre-line break-words leading-relaxed">
            ${comment.content || ""}
          </div>
        `;

          // แสดงรูปภาพ (ถ้ามี)
          if (comment.image_url) {
            commentHtml += `
          <div class="comment-image mt-3 inline-block">
            <img src="${comment.image_url}" alt="Comment image" class="rounded-lg max-w-full border border-gray-200 hover-scale">
          </div>
        `;
          }

          commentHtml += `
        </div>
      `;

          commentEl.innerHTML = commentHtml;
          commentsContent.appendChild(commentEl);

          // เพิ่ม event listener สำหรับปุ่มแก้ไขความคิดเห็น
          const editButtons = commentEl.querySelectorAll(".edit-comment-btn");
          editButtons.forEach((button) => {
            button.addEventListener("click", () => {
              // หาความคิดเห็นที่ต้องการแก้ไข
              const commentId = button.getAttribute("data-id");
              const targetComment = comments.find(c => c.id === parseInt(commentId));

              if (targetComment) {
                initEditCommentForm(targetComment);

                // เปิด modal แก้ไขความคิดเห็น
                const editCommentModal = document.getElementById("edit-comment-modal");
                const editCommentModalContent = document.getElementById("edit-comment-modal-content");
                editCommentModal.classList.remove("hidden");
                setTimeout(() => {
                  editCommentModalContent.classList.remove("scale-95", "opacity-0");
                  editCommentModalContent.classList.add("scale-100", "opacity-100");
                }, 10);
              }
            });
          });

          // เพิ่ม event listener สำหรับปุ่มลบความคิดเห็น
          const deleteButtons = commentEl.querySelectorAll(".delete-comment-btn");
          deleteButtons.forEach((button) => {
            button.addEventListener("click", () => {
              const commentId = button.getAttribute("data-id");
              document.getElementById("delete-comment-id").value = commentId;

              // เปิด modal ยืนยันการลบความคิดเห็น
              const deleteCommentModal = document.getElementById("delete-comment-modal");
              const deleteCommentModalContent = document.getElementById("delete-comment-modal-content");
              deleteCommentModal.classList.remove("hidden");
              setTimeout(() => {
                deleteCommentModalContent.classList.remove("scale-95", "opacity-0");
                deleteCommentModalContent.classList.add("scale-100", "opacity-100");
              }, 10);
            });
          });

          // เพิ่ม event listener สำหรับปุ่มเมนูความคิดเห็น
          const menuButtons = commentEl.querySelectorAll(".comment-menu-btn");
          menuButtons.forEach((button) => {
            button.addEventListener("click", function (e) {
              e.stopPropagation();

              // ปิดเมนูดรอปดาวน์อื่นๆ ทั้งหมดก่อน
              document.querySelectorAll(".comment-dropdown").forEach((dropdown) => {
                if (dropdown !== this.nextElementSibling) {
                  dropdown.classList.add("scale-95", "opacity-0");
                  setTimeout(() => {
                    dropdown.classList.add("hidden");
                  }, 200);
                }
              });

              // เปิด/ปิดเมนูปัจจุบัน
              const dropdown = this.nextElementSibling;
              if (dropdown.classList.contains("hidden")) {
                dropdown.classList.remove("hidden");
                setTimeout(() => {
                  dropdown.classList.remove("scale-95", "opacity-0");
                  dropdown.classList.add("scale-100", "opacity-100");
                }, 10);
              } else {
                dropdown.classList.add("scale-95", "opacity-0");
                setTimeout(() => {
                  dropdown.classList.add("hidden");
                }, 200);
              }
            });
          });
        });
      } catch (error) {
        console.error("Error loading comments:", error);
        document.getElementById("comments-loading").classList.add("hidden");
        const commentsContent = document.getElementById("comments-content");
        commentsContent.innerHTML = `
      <div class="p-6 text-center">
        <div class="text-red-500 mb-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
          </svg>
        </div>
        <h3 class="text-lg font-medium text-gray-900 mb-2">เกิดข้อผิดพลาดในการโหลดความคิดเห็น</h3>
        <p class="text-gray-500">โปรดรีเฟรชหน้าเว็บและลองใหม่อีกครั้ง</p>
      </div>
    `;
        commentsContent.classList.remove("hidden");
      }
    }
    // สร้างความคิดเห็นใหม่
    async function createComment(postId, content, imageUrl = null) {
      try {
        const {
          data: { user },
        } = await supabase.auth.getUser();

        if (!user) {
          throw new Error("ไม่พบผู้ใช้งาน กรุณาเข้าสู่ระบบ");
        }

        // สร้างความคิดเห็นใหม่
        const { data, error } = await supabase.from("comments").insert({
          post_id: postId,
          content: content,
          author_id: user.id,
          author_name: user.user_metadata?.display_name || user.email,
          image_url: imageUrl,
        });

        if (error) {
          throw error;
        }

        // เพิ่มจำนวนความคิดเห็นด้วยตัวเอง เนื่องจาก trigger ไม่ทำงานตามที่คาดหวัง
        await incrementCommentCount(postId);

        return data;
      } catch (error) {
        console.error("Error creating comment:", error);
        throw error;
      }
    }

    // ลดจำนวนความคิดเห็น
    async function decrementCommentCount(postId) {
      try {
        // ดึงข้อมูลจำนวนความคิดเห็นปัจจุบัน
        const { data: post, error } = await supabase
          .from("posts")
          .select("comment_count")
          .eq("id", postId)
          .single();

        if (error) throw error;

        // ตรวจสอบและอัปเดตจำนวนความคิดเห็น
        const currentCount = post.comment_count || 0;
        const newCount = Math.max(0, currentCount - 1); // ไม่ให้ต่ำกว่า 0

        // อัปเดตจำนวนความคิดเห็น
        const { error: updateError } = await supabase
          .from("posts")
          .update({ comment_count: newCount })
          .eq("id", postId);

        if (updateError) throw updateError;

        return true;
      } catch (error) {
        console.error("Error in decrementCommentCount:", error);
        return false;
      }
    }

    // บันทึกข้อมูลการเข้าชมในตาราง posts_view
    async function recordPostView(postId, currentUser) {
      try {
        // ตรวจสอบว่าควรบันทึกการเข้าชมหรือไม่ (ป้องกันการนับซ้ำจากการรีเฟรชหน้า)
        const viewedPosts = JSON.parse(
          localStorage.getItem("viewedPosts") || "{}"
        );
        const lastViewTime = viewedPosts[postId] || 0;
        const currentTime = new Date().getTime();
        const fiveMinutesInMs = 5 * 60 * 1000; // 5 นาทีในหน่วย milliseconds

        // บันทึกการเข้าชมเมื่อยังไม่เคยดูกระทู้นี้ หรือดูครั้งล่าสุดนานกว่า 5 นาที
        if (!lastViewTime || currentTime - lastViewTime > fiveMinutesInMs) {
          // บันทึกเวลาที่ดูกระทู้นี้ใน localStorage
          viewedPosts[postId] = currentTime;
          localStorage.setItem("viewedPosts", JSON.stringify(viewedPosts));

          // เตรียมข้อมูลสำหรับบันทึก
          const viewData = {
            post_id: postId,
            viewer_type: currentUser ? "authenticated" : "anonymous",
            viewer_id: currentUser?.id || null,
          };

          // บันทึกข้อมูลการเข้าชมลงในตาราง posts_view
          const { error } = await supabase
            .from("posts_view")
            .insert(viewData);

          if (error) {
            console.error("Error recording post view:", error);
            return false;
          }

          return true;
        }

        return false;
      } catch (error) {
        console.error("Error in recordPostView:", error);
        return false;
      }
    }

    // ดึงจำนวนการเข้าชมจากตาราง posts_view
    async function getPostViewCount(postId) {
      try {
        // นับจำนวนการเข้าชมทั้งหมดของกระทู้
        const { count, error } = await supabase
          .from("posts_view")
          .select("*", { count: "exact", head: true })
          .eq("post_id", postId);

        if (error) {
          console.error("Error getting post view count:", error);
          return 0;
        }

        return count || 0;
      } catch (error) {
        console.error("Error in getPostViewCount:", error);
        return 0;
      }
    }

    // ฟังก์ชันเตรียมฟอร์มแก้ไขกระทู้
    function initEditForm() {
      // รีเซ็ตตัวแปรสำหรับการแก้ไขกระทู้
      imagesToRemove = [];
      newImagesToUpload = [];

      // ใส่ข้อมูลกระทู้ปัจจุบันในฟอร์มแก้ไข
      document.getElementById("edit-title").value = currentPost.title;
      document.getElementById("edit-content").value = currentPost.content;

      // แสดงรูปภาพปัจจุบัน (ถ้ามี)
      const editPostImages = document.getElementById("edit-post-images");
      editPostImages.innerHTML = "";

      if (currentPost.image_urls && currentPost.image_urls.length > 0) {
        document.getElementById("current-images").classList.remove("hidden");

        currentPost.image_urls.forEach((imageUrl, index) => {
          const imageContainer = document.createElement("div");
          imageContainer.className = "relative border border-gray-300 rounded-lg p-1 overflow-hidden group";
          imageContainer.dataset.url = imageUrl;

          const image = document.createElement("img");
          image.src = imageUrl;
          image.alt = "Post image";
          image.className = "w-full h-32 object-cover rounded";

          const removeButton = document.createElement("button");
          removeButton.type = "button";
          removeButton.className = "absolute top-1 right-1 bg-white rounded-full p-1 shadow-md hover:bg-red-50 transition-colors";
          removeButton.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          `;
          removeButton.addEventListener("click", () => {
            // เพิ่ม URL ของรูปภาพที่จะลบไปยังรายการ
            imagesToRemove.push(imageUrl);
            // ลบ DOM element ของรูปภาพ
            imageContainer.remove();

            // ซ่อนส่วน "รูปภาพปัจจุบัน" ถ้าไม่มีรูปภาพเหลืออยู่
            if (editPostImages.children.length === 0) {
              document.getElementById("current-images").classList.add("hidden");
            }
          });

          imageContainer.appendChild(image);
          imageContainer.appendChild(removeButton);
          editPostImages.appendChild(imageContainer);
        });
      } else {
        document.getElementById("current-images").classList.add("hidden");
      }

      // ล้างพื้นที่แสดงตัวอย่างรูปภาพใหม่
      document.getElementById("edit-image-previews").innerHTML = "";

      // ซ่อนข้อความแจ้งเตือน
      document.getElementById("edit-error-message").classList.add("hidden");
      document.getElementById("edit-success-message").classList.add("hidden");
    }

    // ฟังก์ชันเตรียมฟอร์มแก้ไขความคิดเห็น 
    function initEditCommentForm(comment) {
      console.log("Initializing edit comment form with:", comment); // เพิ่ม log เพื่อตรวจสอบ

      // เก็บข้อมูลความคิดเห็นที่กำลังแก้ไข
      currentComment = comment;

      // รีเซ็ตตัวแปรสำหรับการแก้ไขความคิดเห็น
      removeCommentImage = false;
      newCommentImage = null;

      // ใส่ข้อมูลความคิดเห็นปัจจุบันในฟอร์ม
      document.getElementById("edit-comment-id").value = comment.id;
      document.getElementById("edit-comment-content").value = comment.content || "";

      // ซ่อนข้อความแจ้งเตือน
      document.getElementById("edit-comment-error-message").classList.add("hidden");
      document.getElementById("edit-comment-success-message").classList.add("hidden");

      // รีเซ็ตข้อมูลรูปภาพ
      document.getElementById("edit-comment-image-upload").value = "";
      document.getElementById("selected-comment-image-name").textContent = "";
      document.getElementById("edit-comment-image-preview-container").classList.add("hidden");

      // แสดงรูปภาพปัจจุบัน (ถ้ามี)
      const currentImageContainer = document.getElementById("current-comment-image");
      if (comment.image_url) {
        document.getElementById("edit-comment-current-image").src = comment.image_url;
        currentImageContainer.classList.remove("hidden");
        document.getElementById("add-comment-image-section").classList.add("hidden");
      } else {
        currentImageContainer.classList.add("hidden");
        document.getElementById("add-comment-image-section").classList.remove("hidden");
      }
    }

    // ฟังก์ชันปิด modal แก้ไขกระทู้
    function closeEditModal() {
      const editModal = document.getElementById("edit-modal");
      const editModalContent = document.getElementById("edit-modal-content");

      editModalContent.classList.remove("scale-100", "opacity-100");
      editModalContent.classList.add("scale-95", "opacity-0");
      setTimeout(() => {
        editModal.classList.add("hidden");
      }, 200);
    }

    // ฟังก์ชันปิด modal แก้ไขความคิดเห็น
    function closeEditCommentModal() {
      const editCommentModal = document.getElementById("edit-comment-modal");
      const editCommentModalContent = document.getElementById("edit-comment-modal-content");

      editCommentModalContent.classList.remove("scale-100", "opacity-100");
      editCommentModalContent.classList.add("scale-95", "opacity-0");
      setTimeout(() => {
        editCommentModal.classList.add("hidden");
      }, 200);
    }

    // ฟังก์ชันจัดการอัปโหลดรูปภาพใหม่
    function handleEditImageUpload(e) {
      const files = Array.from(e.target.files);
      const imagePreviews = document.getElementById("edit-image-previews");

      files.forEach((file) => {
        // ตรวจสอบประเภทไฟล์และขนาด
        if (!file.type.match('image.*')) {
          alert('กรุณาอัปโหลดไฟล์รูปภาพเท่านั้น');
          return;
        }

        if (file.size > 5 * 1024 * 1024) { // > 5MB
          alert('ขนาดไฟล์ต้องไม่เกิน 5MB');
          return;
        }

        // เพิ่มไฟล์ในรายการที่จะอัปโหลด
        newImagesToUpload.push(file);

        // สร้างตัวอย่างรูปภาพ
        const previewContainer = document.createElement("div");
        previewContainer.className = "relative border border-gray-300 rounded-lg p-1 overflow-hidden group";

        const preview = document.createElement("img");
        preview.className = "w-full h-32 object-cover rounded";

        const removeButton = document.createElement("button");
        removeButton.type = "button";
        removeButton.className = "absolute top-1 right-1 bg-white rounded-full p-1 shadow-md hover:bg-red-50 transition-colors";
        removeButton.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        `;

        // อ่านไฟล์และแสดงตัวอย่าง
        const reader = new FileReader();
        reader.onload = function (e) {
          preview.src = e.target.result;
        };
        reader.readAsDataURL(file);

        // เพิ่ม event listener สำหรับปุ่มลบ
        removeButton.addEventListener("click", function () {
          const index = newImagesToUpload.indexOf(file);
          if (index !== -1) {
            newImagesToUpload.splice(index, 1);
          }
          previewContainer.remove();
        });

        previewContainer.appendChild(preview);
        previewContainer.appendChild(removeButton);
        imagePreviews.appendChild(previewContainer);
      });

      // รีเซ็ต input เพื่อให้สามารถเลือกไฟล์เดิมซ้ำได้
      e.target.value = "";
    }

    // ฟังก์ชันจัดการอัปโหลดรูปภาพใหม่สำหรับความคิดเห็น
    function handleEditCommentImageUpload(e) {
      const file = e.target.files[0];
      if (!file) return;

      // ตรวจสอบประเภทไฟล์และขนาด
      if (!file.type.match('image.*')) {
        alert('กรุณาอัปโหลดไฟล์รูปภาพเท่านั้น');
        e.target.value = "";
        return;
      }

      if (file.size > 5 * 1024 * 1024) { // > 5MB
        alert('ขนาดไฟล์ต้องไม่เกิน 5MB');
        e.target.value = "";
        return;
      }

      // เก็บไฟล์ที่จะอัปโหลด
      newCommentImage = file;

      // แสดงชื่อไฟล์
      document.getElementById("selected-comment-image-name").textContent = file.name;

      // แสดงตัวอย่างรูปภาพ
      const previewContainer = document.getElementById("edit-comment-image-preview-container");
      const preview = document.getElementById("edit-comment-image-preview");

      const reader = new FileReader();
      reader.onload = function (e) {
        preview.src = e.target.result;
        previewContainer.classList.remove("hidden");
      };
      reader.readAsDataURL(file);
    }

    // ฟังก์ชันจัดการการส่งฟอร์มแก้ไขกระทู้
    async function handleEditFormSubmit(e) {
      e.preventDefault();

      const title = document.getElementById("edit-title").value.trim();
      const content = document.getElementById("edit-content").value.trim();
      const errorMessage = document.getElementById("edit-error-message");
      const successMessage = document.getElementById("edit-success-message");
      const saveButton = document.getElementById("save-edit-btn");

      // ซ่อนข้อความแจ้งเตือนเก่า
      errorMessage.classList.add("hidden");
      successMessage.classList.add("hidden");

      // ตรวจสอบข้อมูล
      if (!title || !content) {
        errorMessage.textContent = "โปรดกรอกหัวข้อและเนื้อหากระทู้";
        errorMessage.classList.remove("hidden");
        return;
      }

      // แสดงสถานะกำลังบันทึก
      saveButton.disabled = true;
      const originalBtnText = saveButton.innerHTML;
      saveButton.innerHTML = `
        <svg class="animate-spin h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        กำลังบันทึก...
      `;

      try {
        // ดึงรายการรูปภาพปัจจุบันที่ไม่ได้ถูกลบ
        let updatedImageUrls = [];
        if (currentPost.image_urls) {
          updatedImageUrls = currentPost.image_urls.filter(
            (url) => !imagesToRemove.includes(url)
          );
        }

        // อัปโหลดรูปภาพใหม่
        for (const file of newImagesToUpload) {
          try {
            const imageUrl = await uploadImage(file, 'posts');
            updatedImageUrls.push(imageUrl);
          } catch (uploadError) {
            console.error("Error uploading image:", uploadError);
            throw new Error("เกิดข้อผิดพลาดในการอัปโหลดรูปภาพ: " + uploadError.message);
          }
        }

        // อัปเดตข้อมูลกระทู้
        const { error } = await supabase
          .from("posts")
          .update({
            title,
            content,
            image_urls: updatedImageUrls,
            updated_at: new Date().toISOString(),
          })
          .eq("id", currentPost.id);

        if (error) throw error;

        // แสดงข้อความสำเร็จ
        successMessage.innerHTML = `
          <div class="flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            แก้ไขกระทู้สำเร็จ กำลังรีเฟรช...
          </div>
        `;
        successMessage.classList.remove("hidden");

        // รีโหลดข้อมูลกระทู้เพื่อแสดงการเปลี่ยนแปลง
        setTimeout(async () => {
          const {
            data: { user },
          } = await supabase.auth.getUser();

          await loadPost(currentPost.id, user);
          closeEditModal();
        }, 1500);
      } catch (error) {
        console.error("Error updating post:", error);

        errorMessage.innerHTML = `
          <div class="flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
            <span>เกิดข้อผิดพลาดในการแก้ไขกระทู้: ${error.message || 'โปรดลองอีกครั้ง'}</span>
          </div>
        `;
        errorMessage.classList.remove("hidden");
      } finally {
        // คืนสถานะปุ่มบันทึก
        saveButton.disabled = false;
        saveButton.innerHTML = originalBtnText;
      }
    }

    // ฟังก์ชันจัดการการส่งฟอร์มแก้ไขความคิดเห็น
    async function handleEditCommentFormSubmit(e) {
      e.preventDefault();

      const commentId = document.getElementById("edit-comment-id").value;
      const content = document.getElementById("edit-comment-content").value.trim();
      const errorMessage = document.getElementById("edit-comment-error-message");
      const successMessage = document.getElementById("edit-comment-success-message");
      const saveButton = document.getElementById("save-edit-comment-btn");

      // ซ่อนข้อความแจ้งเตือนเก่า
      errorMessage.classList.add("hidden");
      successMessage.classList.add("hidden");

      // ตรวจสอบข้อมูล
      if (!content && !currentComment.image_url && !newCommentImage && !removeCommentImage) {
        errorMessage.textContent = "โปรดใส่ข้อความหรือรูปภาพ";
        errorMessage.classList.remove("hidden");
        return;
      }

      // แสดงสถานะกำลังบันทึก
      saveButton.disabled = true;
      const originalBtnText = saveButton.innerHTML;
      saveButton.innerHTML = `
        <svg class="animate-spin h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        กำลังบันทึก...
      `;

      try {
        // เตรียมข้อมูลสำหรับอัปเดต
        const updateData = {
          content,
          updated_at: new Date().toISOString(),
        };

        // จัดการรูปภาพ
        if (removeCommentImage) {
          // ลบรูปภาพ
          updateData.image_url = null;
        } else if (newCommentImage) {
          // อัปโหลดรูปภาพใหม่
          try {
            const imageUrl = await uploadImage(newCommentImage, "comments");
            updateData.image_url = imageUrl;
          } catch (uploadError) {
            console.error("Error uploading image:", uploadError);
            throw new Error("เกิดข้อผิดพลาดในการอัปโหลดรูปภาพ: " + uploadError.message);
          }
        }

        // อัปเดตข้อมูลความคิดเห็น
        const { error } = await supabase
          .from("comments")
          .update(updateData)
          .eq("id", commentId);

        if (error) throw error;

        // แสดงข้อความสำเร็จ
        successMessage.innerHTML = `
          <div class="flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            แก้ไขความคิดเห็นสำเร็จ กำลังรีเฟรช...
          </div>
        `;
        successMessage.classList.remove("hidden");

        // รีโหลดความคิดเห็นเพื่อแสดงการเปลี่ยนแปลง
        setTimeout(async () => {
          const {
            data: { user },
          } = await supabase.auth.getUser();

          const urlParams = new URLSearchParams(window.location.search);
          const postId = urlParams.get("id");

          await loadComments(postId, user);
          closeEditCommentModal();
        }, 1500);
      } catch (error) {
        console.error("Error updating comment:", error);

        errorMessage.innerHTML = `
          <div class="flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
            <span>เกิดข้อผิดพลาดในการแก้ไขความคิดเห็น: ${error.message || 'โปรดลองอีกครั้ง'}</span>
          </div>
        `;
        errorMessage.classList.remove("hidden");
      } finally {
        // คืนสถานะปุ่มบันทึก
        saveButton.disabled = false;
        saveButton.innerHTML = originalBtnText;
      }
    }
  </script>
</body>

</html>