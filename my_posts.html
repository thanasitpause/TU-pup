<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>กระทู้ของฉัน - TU-PUP</title>
  <!-- ตั้งค่าการโหลดทรัพยากร -->
  <link rel="preconnect" href="https://cdn.tailwindcss.com">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!-- Custom styles -->
  <link href="css/tu-common.css" rel="stylesheet">
  <link rel="stylesheet" href="css/sidebar.css">
  <!-- Tailwind Config & CDN -->
  <script src="js/tailwind-config.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // ใช้คอนฟิกจากไฟล์ภายนอก
    tailwind.config = window.tailwindConfig;
  </script>
  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- Supabase Config -->
  <script src="js/supabase-config.js"></script>
  <!-- Sidebar JS -->
  <script src="js/sidebar.js"></script>
  <style>
    /* เพิ่มเติม CSS เฉพาะหน้านี้ */
    .post-card {
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .post-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(135deg, #E60000, #FFCC00);
      transform: translateY(-100%);
      transition: transform 0.3s ease;
    }
    
    .post-card:hover::before {
      transform: translateY(0);
    }
    
    .post-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
    }
    
    .tu-shadow {
      box-shadow: 0 10px 25px -5px rgba(230, 0, 0, 0.1), 0 10px 10px -5px rgba(255, 204, 0, 0.04);
    }
    
    .filter-btn.active {
      background: linear-gradient(135deg, #E60000, #FFCC00);
      color: white;
      box-shadow: 0 4px 10px rgba(230, 0, 0, 0.2);
    }
    
    .search-container {
      position: relative;
    }
    
    .search-container input:focus {
      box-shadow: 0 0 0 3px rgba(230, 0, 0, 0.2);
      border-color: #E60000;
    }
    
    .shimmer {
      background: linear-gradient(90deg, 
        rgba(255,255,255,0) 0%, 
        rgba(255,255,255,0.6) 50%, 
        rgba(255,255,255,0) 100%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }
    
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    .empty-state-icon {
      animation: float 6s ease-in-out infinite;
    }
    
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-15px); }
      100% { transform: translateY(0px); }
    }
  </style>
</head>

<body class="bg-gradient-to-br from-white to-gray-100 min-h-screen">
  <!-- Decorative Elements -->
  <div class="fixed top-0 left-0 w-full h-1 tu-gradient opacity-80 z-50"></div>
  
  <!-- Navbar -->
  <nav class="bg-white shadow-md sticky top-0 z-40">
    <div class="container mx-auto px-4 py-3">
      <div class="flex justify-between items-center">
        <!-- Logo & Hamburger Menu -->
        <div class="flex items-center space-x-4">
          <button id="sidebar-toggle" class="text-gray-500 hover:text-tu-red-500 focus:outline-none">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
          <a href="index.html" class="flex items-center space-x-2">
            <div class="h-8 w-8 rounded-full tu-gradient flex items-center justify-center text-white font-bold text-xs shadow-md">TU</div>
            <span class="font-bold text-2xl tu-gradient-text">TU-PUP</span>
          </a>
        </div>

        <!-- Search Bar -->
        <div class="hidden md:block flex-1 mx-8">
          <div class="search-container">
            <input type="text" id="search-input"
              class="w-full px-4 py-2 pl-10 rounded-full border border-gray-300 focus:outline-none transition-all duration-300"
              placeholder="ค้นหากระทู้ของฉัน..." />
            <div class="absolute left-3 top-2.5 text-gray-400">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
            </div>
            <button id="search-btn" class="absolute right-3 top-2 text-gray-500 hover:text-tu-red-500 transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
              </svg>
            </button>
            <!-- Clear Search Button -->
            <button id="clear-search-btn" class="absolute right-10 top-2 text-gray-400 hover:text-tu-red-500 hidden transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
        </div>

        <!-- User Menu -->
        <div class="flex items-center space-x-4">
          <button id="new-post-btn"
            class="hidden bg-gradient-to-r from-tu-red to-tu-yellow hover:from-tu-red-600 hover:to-tu-yellow-600 text-white font-medium px-4 py-2 rounded-full transition duration-300 transform hover:scale-105 shadow-md">
            <span class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
              </svg>
              สร้างกระทู้ใหม่
            </span>
          </button>

          <div id="user-menu" class="hidden relative group">
            <button class="flex items-center space-x-2 focus:outline-none">
              <div class="relative">
                <img id="user-avatar" src="img/default-avatar.png" alt="User" class="w-8 h-8 rounded-full border-2 border-tu-red-200 transition-transform duration-300 group-hover:scale-110">
                <div class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-500 rounded-full border border-white"></div>
              </div>
              <span id="user-name" class="hidden md:inline text-sm font-medium"></span>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400 group-hover:text-tu-red-500 transition-transform duration-300 group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
            
            <!-- Dropdown menu -->
            <div class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-20 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform group-hover:translate-y-0 translate-y-2">
              <div class="px-4 py-2 border-b border-gray-100">
                <p class="text-sm font-medium text-gray-900" id="dropdown-user-name"></p>
                <p class="text-xs text-gray-500 truncate" id="dropdown-user-email"></p>
              </div>
              <a href="my_posts.html" class="block px-4 py-2 text-sm text-tu-red-500 hover:bg-tu-red-50 font-medium">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-tu-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                  </svg>
                  กระทู้ของฉัน
                </div>
              </a>
              <a href="edit-profile.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-tu-red-50 hover:text-tu-red-500">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                  </svg>
                  แก้ไขโปรไฟล์
                </div>
              </a>
              <hr class="my-1 border-gray-100">
              <button id="logout-btn" class="w-full text-left block px-4 py-2 text-sm text-tu-red-500 hover:bg-tu-red-50">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                  </svg>
                  ออกจากระบบ
                </div>
              </button>
            </div>
          </div>

          <div id="login-menu" class="flex items-center space-x-3">
            <a href="login.html" class="text-tu-red-500 hover:text-tu-red-600 font-medium transition-colors">เข้าสู่ระบบ</a>
            <div class="w-px h-5 bg-gray-300"></div>
            <a href="register.html" class="text-tu-red-500 hover:text-tu-red-600 font-medium transition-colors">สมัครสมาชิก</a>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Search for Mobile -->
  <div class="md:hidden container mx-auto px-4 py-3">
    <div class="search-container">
      <input type="text" id="mobile-search-input"
        class="w-full px-4 py-2 pl-10 rounded-full border border-gray-300 focus:outline-none transition-all duration-300"
        placeholder="ค้นหากระทู้ของฉัน..." />
      <div class="absolute left-3 top-2.5 text-gray-400">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
      </div>
      <button id="mobile-search-btn" class="absolute right-3 top-2 text-gray-500 hover:text-tu-red-500 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
        </svg>
      </button>
      <!-- Clear Search Button (Mobile) -->
      <button id="mobile-clear-search-btn" class="absolute right-10 top-2 text-gray-400 hover:text-tu-red-500 hidden transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-8">
    <div class="max-w-6xl mx-auto">
      <!-- Page Header -->
<div class="mb-8">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between">
    <div class="mb-4 md:mb-0">
      <div class="flex items-center space-x-3 mb-2">
        <a href="index.html" class="flex items-center text-tu-red-500 hover:text-tu-red-600 transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          <span>กลับไปหน้าหลัก</span>
        </a>
      </div>
      <div class="flex items-center">
        <h1 class="text-3xl font-bold text-gray-800 relative inline-block mr-3" id="page-title">
          กระทู้ของฉัน
          <div class="absolute -bottom-1 left-0 w-full h-1 bg-gradient-to-r from-tu-red to-tu-yellow rounded-full"></div>
        </h1>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-tu-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
        </svg>
      </div>
      <p class="text-gray-500 mt-2">กระทู้ทั้งหมดที่คุณสร้างไว้</p>
    </div>
    <div class="flex items-center">
      <!-- เพิ่มรูปภาพด้านขวา -->
      <img src="img/cat-my-post.png" alt="My Posts" class="hidden md:block w-32 h-32 opacity-80">
      <button id="mobile-new-post-btn"
        class="md:hidden bg-gradient-to-r from-tu-red to-tu-yellow hover:from-tu-red-600 hover:to-tu-yellow-600 text-white font-medium px-4 py-2 rounded-full transition duration-300 transform hover:scale-105 shadow-md">
        <span class="flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          สร้างกระทู้
        </span>
      </button>
    </div>
  </div>
</div>
      <!-- Filter Options -->
      <div class="mb-6 bg-white rounded-xl shadow-md p-4 flex flex-wrap gap-3">
        <h3 class="w-full md:w-auto text-sm font-semibold text-gray-500 md:mr-3 mb-2 md:mb-0 flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-tu-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
          </svg>
          ช่วงเวลา:
        </h3>
        <div class="flex flex-wrap gap-2" id="filter-buttons">
          <button data-period="all"
            class="filter-btn active px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 transform hover:scale-105">
            ทั้งหมด
          </button>
          <button data-period="month"
            class="filter-btn bg-white text-gray-700 border border-gray-300 px-4 py-2 rounded-full text-sm font-medium hover:bg-gray-50 transition-all duration-300 transform hover:scale-105">
            เดือนนี้
          </button>
          <button data-period="week"
            class="filter-btn bg-white text-gray-700 border border-gray-300 px-4 py-2 rounded-full text-sm font-medium hover:bg-gray-50 transition-all duration-300 transform hover:scale-105">
            สัปดาห์นี้
          </button>
          <button data-period="year"
            class="filter-btn bg-white text-gray-700 border border-gray-300 px-4 py-2 rounded-full text-sm font-medium hover:bg-gray-50 transition-all duration-300 transform hover:scale-105">
            ปีนี้
          </button>
        </div>
      </div>

      <!-- Sort Options -->
      <div class="mb-6 bg-white rounded-xl shadow-md p-4">
        <div class="flex flex-wrap items-center gap-3">
          <h3 class="text-sm font-semibold text-gray-500 mr-3 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-tu-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12" />
            </svg>
            เรียงตาม:
          </h3>
          <select id="sort-option" class="border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-tu-red-200 text-sm">
            <option value="newest">ล่าสุด</option>
            <option value="oldest">เก่าสุด</option>
            <option value="most_views">ยอดเข้าชมมากสุด</option>
            <option value="most_comments">ความคิดเห็นมากสุด</option>
          </select>
        </div>
      </div>

      <!-- Authentication Required Message -->
      <div id="auth-required" class="hidden text-center py-12 bg-white rounded-xl shadow-md">
        <div class="max-w-md mx-auto p-8">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 mx-auto text-tu-red-300 mb-6 empty-state-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m0 0v2m0-2h2m-2 0H9m3-4V5a3 3 0 00-3-3H6a3 3 0 00-3 3v10a3 3 0 003 3h10a3 3 0 003-3v-5a3 3 0 00-3-3h-3m-1 4l-3 3m0 0l-3-3m3 3V9" />
          </svg>
          <h2 class="text-xl font-bold text-gray-800 mb-3">ต้องเข้าสู่ระบบก่อน</h2>
          <p class="text-gray-600 mb-6">คุณต้องเข้าสู่ระบบเพื่อดูกระทู้ของคุณ</p>
          <a href="login.html" class="inline-flex items-center bg-gradient-to-r from-tu-red to-tu-yellow text-white font-medium px-6 py-2 rounded-lg transition duration-300 transform hover:scale-105 shadow-md">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
            </svg>
            เข้าสู่ระบบ
          </a>
        </div>
      </div>

      <!-- Loading Indicator -->
      <div id="loading-indicator" class="hidden py-12 bg-white rounded-xl shadow-md">
        <div class="flex justify-center">
          <div class="flex flex-col items-center">
            <div class="w-12 h-12 rounded-full border-t-2 border-b-2 border-tu-red-500 animate-spin mb-4"></div>
            <p class="text-gray-500">กำลังโหลดกระทู้ของคุณ<span class="inline-block animate-pulse">...</span></p>
          </div>
        </div>
        
        <div class="mt-6 px-6 space-y-6">
          <div class="flex items-center space-x-4">
            <div class="w-12 h-12 bg-gray-200 rounded-full shimmer"></div>
            <div class="flex-1">
              <div class="h-5 bg-gray-200 rounded w-3/4 shimmer mb-2"></div>
              <div class="h-4 bg-gray-200 rounded w-1/2 shimmer"></div>
            </div>
          </div>
          <div class="flex items-center space-x-4">
            <div class="w-12 h-12 bg-gray-200 rounded-full shimmer"></div>
            <div class="flex-1">
              <div class="h-5 bg-gray-200 rounded w-2/3 shimmer mb-2"></div>
              <div class="h-4 bg-gray-200 rounded w-1/2 shimmer"></div>
            </div>
          </div>
          <div class="flex items-center space-x-4">
            <div class="w-12 h-12 bg-gray-200 rounded-full shimmer"></div>
            <div class="flex-1">
              <div class="h-5 bg-gray-200 rounded w-4/5 shimmer mb-2"></div>
              <div class="h-4 bg-gray-200 rounded w-1/2 shimmer"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Search Loading Indicator -->
      <div id="search-loading" class="hidden py-8 bg-white rounded-xl shadow-md">
        <div class="flex flex-col items-center">
          <div class="w-10 h-10 rounded-full border-t-2 border-b-2 border-tu-red-500 animate-spin mb-2"></div>
          <p class="text-gray-600">กำลังค้นหา<span class="inline-block animate-pulse">...</span></p>
        </div>
      </div>

      <!-- No Posts Message -->
      <div id="no-posts-message" class="hidden text-center py-12 bg-white rounded-xl shadow-md">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-gray-300 mb-4 empty-state-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <h3 class="text-xl font-semibold text-gray-700 mb-2">คุณยังไม่มีกระทู้</h3>
        <p class="text-gray-500 mb-6">เริ่มสร้างกระทู้แรกของคุณเพื่อแชร์ความคิดเห็นกับคนอื่นๆ</p>
        <a href="new-post.html" class="inline-flex items-center bg-gradient-to-r from-tu-red to-tu-yellow text-white font-medium px-5 py-2 rounded-full transition duration-300 transform hover:scale-105 shadow-md">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          สร้างกระทู้ใหม่
        </a>
      </div>

      <!-- Posts Grid Container -->
      <div id="posts-container" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Posts will be dynamically inserted here -->
      </div>

      <!-- Load More Button -->
      <div class="mt-8 text-center">
        <button id="load-more-btn"
          class="hidden bg-white border-2 border-tu-red hover:bg-tu-red-50 text-tu-red-500 font-medium px-6 py-2 rounded-full transition duration-300 transform hover:scale-105 flex items-center mx-auto">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
          </svg>
          โหลดเพิ่มเติม
        </button>
      </div>
    </div>
  </main>

  <!-- Back to Top Button -->
  <button id="back-to-top" class="fixed bottom-6 right-6 bg-gradient-to-r from-tu-red to-tu-yellow text-white rounded-full p-3 shadow-lg hover:shadow-xl transform transition-transform hover:scale-110 opacity-0 invisible">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 11l7-7 7 7M5 19l7-7 7 7" />
    </svg>
  </button>

  <!-- Footer -->
  <footer class="bg-white border-t mt-12 py-8">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-6 md:mb-0">
          <div class="flex items-center space-x-2 mb-3">
            <div class="h-8 w-8 rounded-full tu-gradient flex items-center justify-center text-white font-bold text-xs">TU</div>
            <span class="font-bold text-2xl tu-gradient-text">TU-PUP</span>
          </div>
          <p class="text-gray-600 max-w-md">ระบบกระดานสนทนาสำหรับประชาคมธรรมศาสตร์ แลกเปลี่ยนความคิดเห็น ถาม-ตอบปัญหา แชร์ประสบการณ์</p>
        </div>
        <p class="text-gray-600 text-sm">&copy; 2025 TU-PUP. สงวนลิขสิทธิ์.</p>
      </div>
    </div>
  </footer>
  <script>
    // ตัวแปรสำหรับการจัดการข้อมูล
    const postsPerPage = 6;
    let currentPeriod = "all";
    let currentSort = "newest";
    let lastPostId = null;
    let postsData = [];
    let isSearchMode = false;
    let searchTimeout = null;
    let currentSearchQuery = '';
    let originalPostsData = []; // เก็บข้อมูลกระทู้ก่อนการค้นหา
    let currentUser = null;

    document.addEventListener("DOMContentLoaded", async function () {
      // ตรวจสอบสถานะการล็อกอิน
      const { data: { user } } = await supabase.auth.getUser();
      currentUser = user;

      // แสดงหรือซ่อนปุ่ม Back to Top เมื่อเลื่อนหน้า
      const backToTopButton = document.getElementById('back-to-top');
      window.addEventListener('scroll', function() {
        if (window.scrollY > 500) {
          backToTopButton.classList.remove('opacity-0', 'invisible');
          backToTopButton.classList.add('opacity-100', 'visible');
        } else {
          backToTopButton.classList.remove('opacity-100', 'visible');
          backToTopButton.classList.add('opacity-0', 'invisible');
        }
      });
      
      // เลื่อนขึ้นด้านบนเมื่อกดปุ่ม
      backToTopButton.addEventListener('click', function() {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });

      // ตรวจสอบว่ามีการล็อกอินหรือไม่
      if (!user) {
        // ถ้าไม่มีการล็อกอิน ให้แสดงข้อความให้ล็อกอิน
        document.getElementById("auth-required").classList.remove("hidden");
        document.getElementById("filter-buttons").classList.add("hidden");
        document.getElementById("sort-option").parentElement.parentElement.classList.add("hidden");
        return;
      }

      // แสดงหรือซ่อนเมนูตามสถานะล็อกอิน
      if (user) {
        document.getElementById("login-menu").classList.add("hidden");
        document.getElementById("user-menu").classList.remove("hidden");
        document.getElementById("new-post-btn").classList.remove("hidden");

        const displayName = user.user_metadata?.display_name || user.email;
        document.getElementById("user-name").textContent = displayName;
        document.getElementById("dropdown-user-name").textContent = displayName;
        document.getElementById("dropdown-user-email").textContent = user.email;

        // ตรวจสอบรูปโปรไฟล์
        if (user.user_metadata?.avatar_url) {
          document.getElementById("user-avatar").src = user.user_metadata.avatar_url;
        }

        // Event listener สำหรับปุ่มล็อกเอาต์
        document.getElementById("logout-btn").addEventListener("click", async () => {
          const { error } = await supabase.auth.signOut();
          if (!error) {
            window.location.reload();
          }
        });
      }

      // Event listeners สำหรับปุ่มสร้างกระทู้ใหม่
      const newPostBtn = document.getElementById("new-post-btn");
      if (newPostBtn) {
        newPostBtn.addEventListener("click", () => {
          window.location.href = "new-post.html";
        });
      }

      const mobileNewPostBtn = document.getElementById("mobile-new-post-btn");
      if (mobileNewPostBtn) {
        mobileNewPostBtn.addEventListener("click", () => {
          if (user) {
            window.location.href = "new-post.html";
          } else {
            window.location.href = "login.html";
          }
        });
      }
      // Event listeners สำหรับปุ่มกรอง
      const filterButtons = document.querySelectorAll(".filter-btn");
      filterButtons.forEach((button) => {
        button.addEventListener("click", async function () {
          // ยกเลิกการค้นหาก่อนถ้ามีการกรอง
          if (isSearchMode) {
            resetSearch();
          }

          // ยกเลิกการเลือกปุ่มอื่นๆ
          filterButtons.forEach((btn) => {
            btn.classList.remove("active");
            btn.classList.add("bg-white", "text-gray-700", "border", "border-gray-300");
          });

          // เลือกปุ่มปัจจุบัน
          this.classList.remove("bg-white", "text-gray-700", "border", "border-gray-300");
          this.classList.add("active");

          // ตั้งค่าช่วงเวลาที่เลือก
          currentPeriod = this.getAttribute("data-period");

          // รีเซ็ตตัวแปรและโหลดกระทู้ใหม่
          lastPostId = null;
          await loadMyPosts();
        });
      });

      // Event listener สำหรับการเปลี่ยนวิธีการเรียงลำดับ
      document.getElementById("sort-option").addEventListener("change", async function() {
        currentSort = this.value;
        lastPostId = null;
        await loadMyPosts();
      });

      // Event listener สำหรับปุ่มโหลดเพิ่มเติม
      document.getElementById("load-more-btn").addEventListener("click", async function () {
        if (isSearchMode) {
          await loadMoreSearchResults(currentSearchQuery);
        } else {
          await loadMoreMyPosts();
        }
      });

      // ตั้งค่า Real-time Search
      setupRealTimeSearch();

      // โหลดกระทู้เมื่อโหลดหน้าเสร็จ
      await loadMyPosts();
    });

    // ตั้งค่า Real-time Search
    function setupRealTimeSearch() {
      // Desktop Search
      const searchInput = document.getElementById("search-input");
      const clearSearchBtn = document.getElementById("clear-search-btn");

      // เพิ่ม Event Listener สำหรับการพิมพ์ค้นหา (desktop)
      searchInput.addEventListener("input", function () {
        handleSearchInput(this.value.trim(), clearSearchBtn);
      });

      // ปุ่มล้างการค้นหา (desktop)
      clearSearchBtn.addEventListener("click", function () {
        clearSearch(searchInput, clearSearchBtn);
      });

      // Mobile Search
      const mobileSearchInput = document.getElementById("mobile-search-input");
      const mobileClearSearchBtn = document.getElementById("mobile-clear-search-btn");

      // เพิ่ม Event Listener สำหรับการพิมพ์ค้นหา (mobile)
      mobileSearchInput.addEventListener("input", function () {
        // ซิงค์ค่ากับ desktop search
        searchInput.value = this.value;
        handleSearchInput(this.value.trim(), mobileClearSearchBtn);
      });

      // ปุ่มล้างการค้นหา (mobile)
      mobileClearSearchBtn.addEventListener("click", function () {
        clearSearch(mobileSearchInput, mobileClearSearchBtn);
        searchInput.value = ''; // ซิงค์ค่ากับ desktop search
      });

      // เพิ่ม Event Listener สำหรับปุ่มค้นหา (สำหรับการกดปุ่มค้นหาโดยตรง)
      document.getElementById("search-btn").addEventListener("click", function () {
        const query = searchInput.value.trim();
        if (query) {
          performSearch(query);
        }
      });

      document.getElementById("mobile-search-btn").addEventListener("click", function () {
        const query = mobileSearchInput.value.trim();
        if (query) {
          searchInput.value = query; // ซิงค์ค่ากับ desktop search
          performSearch(query);
        }
      });
    }

    // จัดการกับการพิมพ์ค้นหา
    function handleSearchInput(query, clearButton) {
      // แสดงหรือซ่อนปุ่มล้างการค้นหา
      if (query) {
        clearButton.classList.remove("hidden");

        // ยกเลิก timeout เดิม (ถ้ามี) และตั้ง timeout ใหม่
        if (searchTimeout) {
          clearTimeout(searchTimeout);
        }

        // แสดง Loading Indicator
        if (query !== currentSearchQuery) {
          document.getElementById("search-loading").classList.remove("hidden");
        }

        // ตั้ง timeout เพื่อไม่ให้ค้นหาทุกครั้งที่พิมพ์
        searchTimeout = setTimeout(() => {
          performSearch(query);
        }, 500); // รอ 0.5 วินาทีหลังจากหยุดพิมพ์แล้วค่อยค้นหา
      } else {
        clearButton.classList.add("hidden");

        // ถ้าล้างการค้นหา ให้กลับไปแสดงกระทู้ทั้งหมด
        if (isSearchMode) {
          resetSearch();
        }
      }
    }

    // ล้างการค้นหา
    function clearSearch(inputElement, clearButton) {
      inputElement.value = '';
      clearButton.classList.add("hidden");
      resetSearch();
    }

    // รีเซ็ตการค้นหากลับไปแสดงกระทู้ทั้งหมด
    async function resetSearch() {
      isSearchMode = false;
      currentSearchQuery = '';
      document.getElementById("page-title").innerHTML = `
        กระทู้ของฉัน
        <div class="absolute -bottom-1 left-0 w-full h-1 bg-gradient-to-r from-tu-red to-tu-yellow rounded-full"></div>
      `;
      document.getElementById("search-loading").classList.add("hidden");

      // คืนค่าข้อมูลกระทู้จากข้อมูลเดิมก่อนการค้นหา
      if (originalPostsData.length > 0) {
        postsData = [...originalPostsData];
        sortPosts(); // เรียงลำดับตามที่เลือกไว้

        // รีเซ็ต container และแสดงกระทู้
        const postsContainer = document.getElementById("posts-container");
        postsContainer.innerHTML = "";
        postsContainer.classList.remove("hidden");

        // แสดงกระทู้
        const postsToShow = postsData.slice(0, postsPerPage);
        renderMyPosts(postsToShow);

        // ถ้ามีกระทู้มากกว่าจำนวนที่แสดง ให้แสดงปุ่มโหลดเพิ่มเติม
        const loadMoreBtn = document.getElementById("load-more-btn");
        if (postsData.length > postsPerPage) {
          loadMoreBtn.classList.remove("hidden");
          lastPostId = postsPerPage;
        } else {
          loadMoreBtn.classList.add("hidden");
        }
      } else {
        // ถ้าไม่มีข้อมูลเดิม โหลดใหม่
        await loadMyPosts();
      }
    }

    // ทำการค้นหา
    async function performSearch(query) {
      if (query === currentSearchQuery) {
        // ถ้าคำค้นหาเหมือนเดิม ไม่ต้องค้นหาใหม่
        document.getElementById("search-loading").classList.add("hidden");
        return;
      }

      currentSearchQuery = query;
      isSearchMode = !!query;

      if (!query) {
        // ถ้าไม่มีคำค้นหา กลับไปแสดงกระทู้ทั้งหมด
        resetSearch();
        return;
      }

      // แสดง loading indicator
      document.getElementById("search-loading").classList.remove("hidden");
      const noPostsMessage = document.getElementById("no-posts-message");
      const postsContainer = document.getElementById("posts-container");
      const loadMoreBtn = document.getElementById("load-more-btn");
      const pageTitle = document.getElementById("page-title");

      // ซ่อนปุ่มโหลดเพิ่มเติมระหว่างการค้นหา
      loadMoreBtn.classList.add("hidden");

      // อัปเดตชื่อหน้า
      pageTitle.innerHTML = `
        ผลการค้นหา: <span class="text-tu-red-500">"${query}"</span>
        <div class="absolute -bottom-1 left-0 w-full h-1 bg-gradient-to-r from-tu-red to-tu-yellow rounded-full"></div>
      `;

      try {
        // ถ้ายังไม่มีข้อมูลเก็บไว้ ให้โหลดข้อมูลทั้งหมดก่อน
        if (originalPostsData.length === 0 && postsData.length > 0) {
          originalPostsData = [...postsData];
        }

        // ค้นหาจากข้อมูลในหน่วยความจำ
        const searchResults = originalPostsData.filter(post =>
          post.title.toLowerCase().includes(query.toLowerCase()) ||
          post.content.toLowerCase().includes(query.toLowerCase())
        );

        // เรียงลำดับกระทู้
        postsData = searchResults;
        sortPosts();

        // ซ่อน loading indicator
        document.getElementById("search-loading").classList.add("hidden");

        // รีเซ็ต container
        postsContainer.innerHTML = "";

        if (postsData.length === 0) {
          // ไม่พบผลลัพธ์การค้นหา
          postsContainer.classList.add("hidden");
          noPostsMessage.textContent = `ไม่พบกระทู้ที่เกี่ยวข้องกับ "${query}"`;
          noPostsMessage.classList.remove("hidden");
        } else {
          // แสดงผลลัพธ์การค้นหา
          noPostsMessage.classList.add("hidden");
          postsContainer.classList.remove("hidden");

          // แสดงผลการค้นหา
          const postsToShow = postsData.slice(0, postsPerPage);
          renderMyPosts(postsToShow);

          // แสดงปุ่มโหลดเพิ่มเติมถ้ามีผลลัพธ์มากกว่าที่แสดง
          if (postsData.length > postsPerPage) {
            loadMoreBtn.classList.remove("hidden");
            lastPostId = postsPerPage;
          } else {
            loadMoreBtn.classList.add("hidden");
          }
        }
      } catch (error) {
        console.error("Error searching posts:", error);

        // ซ่อน loading indicator ในกรณีเกิดข้อผิดพลาด
        document.getElementById("search-loading").classList.add("hidden");

        // แสดงข้อความผิดพลาด
        noPostsMessage.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-red-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
          </svg>
          <h3 class="text-xl font-semibold text-gray-700 mb-2">เกิดข้อผิดพลาดในการค้นหา</h3>
          <p class="text-gray-500 mb-6">โปรดลองอีกครั้งในภายหลัง</p>
        `;
        noPostsMessage.classList.remove("hidden");
      }
    }

    // ฟังก์ชันสำหรับโหลดกระทู้ของฉัน
    async function loadMyPosts() {
      if (!currentUser) return;

      const loadingIndicator = document.getElementById("loading-indicator");
      const postsContainer = document.getElementById("posts-container");
      const noPostsMessage = document.getElementById("no-posts-message");
      const loadMoreBtn = document.getElementById("load-more-btn");
      const searchLoading = document.getElementById("search-loading");

      // แสดง loading indicator
      loadingIndicator.classList.remove("hidden");
      searchLoading.classList.add("hidden");
      postsContainer.classList.add("hidden");
      noPostsMessage.classList.add("hidden");
      loadMoreBtn.classList.add("hidden");

      try {
        // ดึงกระทู้ทั้งหมดที่ผู้ใช้เป็นเจ้าของ
        let query = supabase
          .from("posts")
          .select("*")
          .eq("author_id", currentUser.id);

        // กรองตามช่วงเวลาที่เลือก
        if (currentPeriod !== "all") {
          const now = new Date();
          let startDate = null;

          switch (currentPeriod) {
            case "week":
              // คำนวณวันเริ่มต้นของสัปดาห์นี้ (วันอาทิตย์)
              const startOfWeek = new Date(now);
              startOfWeek.setDate(now.getDate() - now.getDay());
              startOfWeek.setHours(0, 0, 0, 0);
              startDate = startOfWeek;
              break;
            case "month":
              // คำนวณวันเริ่มต้นของเดือนนี้
              startDate = new Date(now.getFullYear(), now.getMonth(), 1);
              break;
            case "year":
              // คำนวณวันเริ่มต้นของปีนี้
              startDate = new Date(now.getFullYear(), 0, 1);
              break;
          }

          if (startDate) {
            query = query.gte("created_at", startDate.toISOString());
          }
        }

        const { data: posts, error } = await query;

        if (error) {
          throw error;
        }

        if (!posts || posts.length === 0) {
          // ไม่พบกระทู้
          loadingIndicator.classList.add("hidden");
          noPostsMessage.classList.remove("hidden");
          return;
        }

        // ดึงข้อมูลจำนวนการเข้าชมของกระทู้ทั้งหมด
        const viewCounts = await getPostsViewCounts(posts);

        // เพิ่มข้อมูลจำนวนการเข้าชมให้กับกระทู้
        postsData = posts.map(post => ({
          ...post,
          viewCount: viewCounts[post.id] || 0
        }));
        // เก็บข้อมูลเดิมก่อนการค้นหา
        originalPostsData = [...postsData];

        // เรียงลำดับกระทู้
        sortPosts();

        // ซ่อน loading indicator
        loadingIndicator.classList.add("hidden");

        // รีเซ็ต container และแสดงกระทู้
        postsContainer.innerHTML = "";
        postsContainer.classList.remove("hidden");

        // แสดงกระทู้
        const postsToShow = postsData.slice(0, postsPerPage);
        renderMyPosts(postsToShow);

        // ถ้ามีกระทู้มากกว่าจำนวนที่แสดง ให้แสดงปุ่มโหลดเพิ่มเติม
        if (postsData.length > postsPerPage) {
          loadMoreBtn.classList.remove("hidden");
          lastPostId = postsPerPage;
        }
      } catch (error) {
        console.error("Error loading my posts:", error);
        loadingIndicator.classList.add("hidden");
        noPostsMessage.textContent = "เกิดข้อผิดพลาดในการโหลดกระทู้";
        noPostsMessage.classList.remove("hidden");
      }
    }

    // ฟังก์ชันสำหรับดึงจำนวนการเข้าชมของกระทู้
    async function getPostsViewCounts(posts) {
      if (!posts || posts.length === 0) return {};

      const viewCounts = {};

      // ดึงจำนวนการเข้าชมทีละกระทู้
      for (const post of posts) {
        const { count, error } = await supabase
          .from("posts_view")
          .select("*", { count: "exact", head: true })
          .eq("post_id", post.id);

        if (!error) {
          viewCounts[post.id] = count || 0;
        }
      }

      return viewCounts;
    }

    // เรียงลำดับกระทู้ตามตัวเลือกที่เลือก
    function sortPosts() {
      switch (currentSort) {
        case "newest":
          postsData.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
          break;
        case "oldest":
          postsData.sort((a, b) => new Date(a.created_at) - new Date(b.created_at));
          break;
        case "most_views":
          postsData.sort((a, b) => b.viewCount - a.viewCount);
          break;
        case "most_comments":
          postsData.sort((a, b) => b.comment_count - a.comment_count);
          break;
      }
    }

    // ฟังก์ชันสำหรับโหลดกระทู้เพิ่มเติม
    async function loadMoreMyPosts() {
      if (!lastPostId || lastPostId >= postsData.length) return;

      const loadMoreBtn = document.getElementById("load-more-btn");
      loadMoreBtn.disabled = true;
      loadMoreBtn.innerHTML = `
        <svg class="animate-spin h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        กำลังโหลด...
      `;

      try {
        // คำนวณกระทู้ที่จะแสดงในหน้าถัดไป
        const endIndex = Math.min(lastPostId + postsPerPage, postsData.length);
        const nextPosts = postsData.slice(lastPostId, endIndex);

        // แสดงกระทู้เพิ่มเติม
        renderMyPosts(nextPosts);

        // อัปเดต lastPostId
        lastPostId = endIndex;

        // ถ้าแสดงกระทู้ครบแล้ว ซ่อนปุ่มโหลดเพิ่มเติม
        if (lastPostId >= postsData.length) {
          loadMoreBtn.classList.add("hidden");
        }
      } catch (error) {
        console.error("Error loading more posts:", error);
      } finally {
        // คืนค่าปุ่มโหลดเพิ่มเติม
        loadMoreBtn.disabled = false;
        loadMoreBtn.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
          </svg>
          โหลดเพิ่มเติม
        `;
      }
    }

    // โหลดผลการค้นหาเพิ่มเติม
    async function loadMoreSearchResults() {
      if (!lastPostId || lastPostId >= postsData.length) return;

      const loadMoreBtn = document.getElementById("load-more-btn");
      loadMoreBtn.disabled = true;
      loadMoreBtn.innerHTML = `
        <svg class="animate-spin h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        กำลังโหลด...
      `;

      try {
        // คำนวณกระทู้ที่จะแสดงในหน้าถัดไป
        const endIndex = Math.min(
          lastPostId + postsPerPage,
          postsData.length
        );
        const nextPosts = postsData.slice(lastPostId, endIndex);

        // แสดงกระทู้เพิ่มเติม
        renderMyPosts(nextPosts);

        // อัปเดต lastPostId
        lastPostId = endIndex;

        // ถ้าแสดงกระทู้ครบแล้ว ซ่อนปุ่มโหลดเพิ่มเติม
        if (lastPostId >= postsData.length) {
          loadMoreBtn.classList.add("hidden");
        }
      } catch (error) {
        console.error("Error loading more search results:", error);
      } finally {
        // คืนค่าปุ่มโหลดเพิ่มเติม
        loadMoreBtn.disabled = false;
        loadMoreBtn.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
          </svg>
          โหลดเพิ่มเติม
        `;
      }
    }

    // ฟังก์ชันสำหรับแสดงกระทู้
    function renderMyPosts(posts) {
      const postsContainer = document.getElementById("posts-container");

      posts.forEach((post) => {
        // สร้าง URL สำหรับหน้ารายละเอียดกระทู้
        const postUrl = `post.html?id=${post.id}`;

        // ตัดเนื้อหาให้สั้นลงถ้ายาวเกินไป
        const shortContent = post.content.length > 100
          ? post.content.substring(0, 100) + "..."
          : post.content;

        // ฟอร์แมตเวลา
        const formattedDate = formatTimestamp(post.created_at);

        // สร้างการ์ดกระทู้
        const postCard = document.createElement("div");
        postCard.className = "post-card bg-white rounded-xl shadow-md p-5 hover-scale-up";
        
        // สุ่มเลือกสไตล์ gradient สำหรับพื้นหลัง
        const gradientStyles = [
          'bg-gradient-red-to-white',
          'bg-gradient-yellow-to-white',
          'bg-gradient-blue-to-white'
        ];
        const randomGradient = gradientStyles[Math.floor(Math.random() * gradientStyles.length)];
        postCard.classList.add(randomGradient);
        
        postCard.innerHTML = `
          <a href="${postUrl}" class="block h-full">
            <div class="relative">
              ${post.image_urls && post.image_urls.length > 0 ? 
                `<div class="absolute top-0 right-0 bg-tu-yellow-500 text-white text-xs px-2 py-1 rounded-full -mt-2 -mr-2">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                  </svg>
                  รูปภาพ
                </div>` : ''
              }
              <h2 class="post-title text-lg font-semibold text-gray-800 mb-2">${post.title}</h2>
            </div>
            <p class="post-content text-gray-600 mb-3">${shortContent}</p>
            
            <div class="flex flex-wrap items-center justify-between mt-4">
              <div class="flex items-center mb-2 sm:mb-0">
                <!-- ใช้ไอคอนผู้ใช้ -->
                <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center overflow-hidden mr-2">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                  </svg>
                </div>
                <span class="post-author text-gray-700 font-medium">${post.author_name || "ไม่ระบุชื่อ"}</span>
              </div>
              
              <div class="flex items-center space-x-3">
                <span class="flex items-center text-sm bg-tu-red-50 text-tu-red-500 py-1 px-2 rounded-full">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                  </svg>
                  ${post.viewCount || 0}
                </span>
                <span class="flex items-center text-sm bg-tu-yellow-50 text-tu-yellow-700 py-1 px-2 rounded-full">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
                  </svg>
                  ${post.comment_count || 0}
                </span>
              </div>
            </div>
            
            <div class="mt-3 pt-3 border-t border-gray-100 flex items-center justify-between">
              <div class="text-xs text-gray-400">${formattedDate}</div>
              
              <!-- ปุ่มแก้ไข/ลบกระทู้ -->
              <div class="flex items-center space-x-2">
                <a href="edit-post.html?id=${post.id}" class="text-sm text-gray-500 hover:text-tu-red-500 transition-colors">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                  </svg>
                </a>
                <button class="delete-post-btn text-sm text-gray-500 hover:text-red-500 transition-colors" data-id="${post.id}">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                  </svg>
                </button>
              </div>
            </div>
          </a>
        `;

        postsContainer.appendChild(postCard);
        
        // เพิ่ม event listener สำหรับปุ่มลบกระทู้
        const deleteBtn = postCard.querySelector('.delete-post-btn');
        if (deleteBtn) {
          deleteBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            const postId = this.getAttribute('data-id');
            if (confirm('คุณแน่ใจหรือไม่ว่าต้องการลบกระทู้นี้? การกระทำนี้ไม่สามารถย้อนกลับได้')) {
              deletePost(postId);
            }
          });
        }
      });
    }

    // ฟังก์ชันสำหรับลบกระทู้
    async function deletePost(postId) {
      try {
        // แสดง loading
        const postsContainer = document.getElementById('posts-container');
        postsContainer.classList.add('opacity-50', 'pointer-events-none');
        
        // ลบกระทู้
        const { error } = await supabase
          .from('posts')
          .delete()
          .eq('id', postId);
          
        if (error) throw error;
        
        // โหลดกระทู้ใหม่
        await loadMyPosts();
      } catch (error) {
        console.error('Error deleting post:', error);
        alert('เกิดข้อผิดพลาดในการลบกระทู้: ' + error.message);
      } finally {
        // คืนค่า container
        const postsContainer = document.getElementById('posts-container');
        postsContainer.classList.remove('opacity-50', 'pointer-events-none');
      }
    }
  </script>
</body>
</html>